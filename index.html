<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>zetmeoOS - V28.3 (Mobile Fix)</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="zetmeoOS">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/96/check-all--v1.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/check-all--v1.png">

    <style>
        :root {
            /* --- C·∫§U H√åNH CHUNG --- */
            --bg-body: #232323; --bg-box: #2d2d2d;
            --text-main: #fcfcfc; --text-dim: #b0b0b0;
            --transition-speed: 0.3s;

            /* --- THEME 1: PASTEL --- */
            --main-color: #FF90BC; --sub-1: #FFC0D9; --sub-2: #F9F9E0; --sub-3: #8ACDD7;
            --check-bg: #ABE7B2; --check-tick: #444;
            
            /* COLORS FOR BOXES */
            --col-urgent: #FF90BC; --col-core: #8ACDD7; --col-found: #FFC0D9; --col-kho: #95a5a6;

            --diff-add-bg: rgba(46, 160, 67, 0.15); --diff-add-text: #7ee787;
            --diff-rem-bg: rgba(248, 81, 73, 0.15); --diff-rem-text: #ff7b72;
            --book-border: #FFC0D9; --book-bg: rgba(255, 192, 217, 0.05);
        }

        /* --- THEME 2: CLASSIC --- */
        [data-theme="classic"] {
            --main-color: #ffadad; --sub-1: #e0bbe4; --sub-2: #ffdac1; --sub-3: #a0c4ff;
            --check-bg: #4cd137; --check-tick: #fff;
            --col-urgent: #ff6b6b; --col-core: #48dbfb; --col-found: #feca57; --col-kho: #b2bec3;
            --book-border: #a0c4ff; --book-bg: rgba(160, 196, 255, 0.05);
        }

        body {
            background-color: var(--bg-body); color: var(--text-main);
            font-family: 'Consolas', 'Segoe UI', sans-serif;
            padding: 15px; max-width: 900px; margin: 0 auto; line-height: 1.5;
            padding-bottom: 120px; transition: all var(--transition-speed);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER & QUOTE --- */
        .header-section { display: grid; grid-template-columns: 1fr 1.5fr; gap: 15px; margin-bottom: 20px; }
        
        .quote-card {
            background-color: #222; border-radius: 12px; border: 2px solid var(--main-color);
            position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            display: flex; flex-direction: column; justify-content: flex-end; padding: 20px;
            background-size: cover; background-position: center; transition: border-color var(--transition-speed);
        }
        .quote-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.3)); z-index: 1; }
        .quote-content { position: relative; z-index: 2; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        .quote-text { font-size: 1.1em; font-weight: bold; font-style: italic; line-height: 1.4; margin-bottom: 10px; font-family: 'Georgia', serif; }
        .quote-author { font-size: 0.85em; color: var(--sub-2); text-align: right; display: block; }

        @media (max-width: 700px) { 
            .header-section { grid-template-columns: 1fr; } 
            .quote-card { aspect-ratio: 1 / 1; width: 100%; min-height: unset; box-sizing: border-box; }
        }

        .stats-container { background-color: #1a1e24; border: 1px solid #444; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .stats-header { color: var(--sub-3); font-weight: bold; margin-bottom: 10px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; font-size: 0.9em; }
        .stat-row { margin-bottom: 8px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; }
        .stat-bar-bg { background-color: #333; height: 6px; border-radius: 4px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .bar-urgent { background-color: var(--col-urgent); } .bar-core { background-color: var(--col-core); } .bar-foundation { background-color: var(--col-found); } .bar-total { background: linear-gradient(90deg, var(--col-urgent), var(--col-core)); }

        .lam-reminder-bar {
            background-color: var(--main-color); color: #4a2c2a; padding: 12px 20px;
            border-radius: 12px; border: 2px solid rgba(255,255,255,0.3); font-weight: bold;
            display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 30px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 1em;
        }
        .lam-icon { margin-right: 10px; font-size: 1.5em; animation: bounce 2s infinite; }
        .lam-label { margin-right: 10px; text-transform: uppercase; font-size: 0.75em; letter-spacing: 1px; background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 6px; }

        /* --- BOX STYLES --- */
        .box { border: 1px solid #444; background-color: var(--bg-box); padding: 15px; border-radius: 10px; margin-bottom: 20px; position: relative; }
        .box[data-type*="URGENT"] { border-left: 4px solid var(--col-urgent); --box-color: var(--col-urgent); } 
        .box[data-type*="CORE"] { border-left: 4px solid var(--col-core); --box-color: var(--col-core); } 
        .box[data-type*="FOUNDATION"] { border-left: 4px solid var(--col-found); --box-color: var(--col-found); } 
        .box[data-type*="KHO"] { border-left: 4px solid var(--col-kho); opacity: 0.8; --box-color: var(--col-kho); }

        h2 { color: var(--box-color, #fff); margin-top: 0; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px dashed #555; font-size: 1.3em; }

        /* --- TIME LOGGER BAR (COMPACT MOBILE FIX) --- */
        .time-logger-bar {
            display: flex; align-items: center; gap: 4px; margin-bottom: 15px;
            background: rgba(0,0,0,0.2); padding: 5px; border-radius: 6px;
            border: 1px solid #444; flex-wrap: nowrap; /* C·∫•m xu·ªëng d√≤ng */
        }
        .logger-input-code { 
            flex: 1; min-width: 0; /* Cho ph√©p co nh·ªè */
            background: transparent; border: 1px solid #555; color: var(--box-color); 
            font-weight: bold; text-align: center; padding: 6px 2px; border-radius: 4px; 
            font-family: monospace; font-size: 0.9em;
        }
        .logger-input-time { 
            width: 35px; background: transparent; border: 1px solid #555; color: #fff; 
            text-align: center; padding: 6px 2px; border-radius: 4px; font-size: 0.9em;
        }
        .logger-btn {
            background-color: var(--box-color); color: #333; border: none;
            padding: 6px 8px; border-radius: 4px; font-weight: bold; cursor: pointer;
            text-transform: uppercase; font-size: 0.8em; white-space: nowrap;
        }
        .timer-btn {
            background-color: transparent; border: 1px solid var(--box-color); color: var(--box-color);
            padding: 6px 4px; border-radius: 4px; font-weight: bold; cursor: pointer;
            font-size: 0.8em; min-width: 30px; text-align: center;
        }
        .timer-btn:hover { background-color: var(--box-color); color: #333; }
        .timer-running { background-color: #fff !important; color: #d63031 !important; border-color: #d63031 !important; animation: pulse 1s infinite; }

        .note { font-size: 0.9em; color: var(--text-dim); margin-bottom: 15px; font-style: italic; display: block; }
        
        /* --- TASK LIST STYLES --- */
        .task-list { list-style: none; padding: 0; }
        .task-item { 
            margin-bottom: 10px; display: flex; align-items: flex-start; 
            padding: 10px 8px; border-radius: 6px; border-bottom: 1px solid #3d3d3d; 
            transition: all 0.2s; background-color: rgba(255,255,255,0.02);
        }
        .task-item:hover { background-color: #383838; }
        
        .indent-1 { margin-left: 0px; } .indent-2 { margin-left: 10px; border-left: 2px solid #555; } .indent-3 { margin-left: 20px; border-left: 2px solid #666; }
        .toggle-btn { cursor: pointer; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 2px; color: var(--sub-3); font-size: 14px; margin-top: 2px; }
        .rotated { transform: rotate(90deg); } .spacer { width: 20px; }

        .task-item input[type="checkbox"] { 
            appearance: none; width: 22px; height: 22px; border: 2px solid var(--text-dim); border-radius: 50%; margin-right: 10px; 
            cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; margin-top: 3px;
        }
        .task-item input:checked { background-color: var(--check-bg); border-color: var(--check-bg); }
        .task-item input:checked::after { content: '‚úî'; color: #333; font-size: 14px; font-weight: bold; }
        
        .task-label { flex: 1; margin-right: 5px; cursor: pointer; position: relative; line-height: 1.5; font-size: 1em; color: #ececec; } 
        .task-id-tag { 
            font-family: 'Consolas', monospace; font-size: 0.85em; font-weight: bold; 
            padding: 1px 5px; border-radius: 4px; margin-right: 6px; 
            color: #222; display: inline-block; background-color: var(--box-color, #ccc); 
        }
        .btn-note-toggle { border: none; background: transparent; padding: 0 5px; cursor: pointer; color: #666; font-size: 1.2em; display: inline-block; margin-right: 5px; vertical-align: middle; }
        .btn-note-toggle.has-content { color: var(--box-color); } 
        .task-item input:checked + .task-label { text-decoration: line-through; color: #666; }
        .task-item input:checked + .task-label .task-id-tag { opacity: 0.3; filter: grayscale(100%); }
        
        .task-note-box { display: none; width: 100%; margin-top: 8px; background-color: var(--bg-body); padding: 8px 12px; border-radius: 4px; border-left: 3px solid var(--box-color); font-size: 0.95em; color: #ccc; }
        .task-note-box.show { display: block; animation: slideDown 0.2s; }
        
        .total-time-badge { font-size: 0.8em; color: var(--box-color); opacity: 0.9; margin-left: 5px; font-weight: bold; }
        .mini-progress-container { display: inline-block; width: 40px; height: 4px; background-color: #444; border-radius: 2px; margin-left: 5px; vertical-align: middle; display: none; }
        .mini-progress-fill { height: 100%; background-color: var(--box-color); border-radius: 2px; width: 0%; transition: width 0.3s; }
        .has-children .mini-progress-container { display: inline-block; }

        /* --- STUDIO STYLES --- */
        .studio-box { margin-top: 30px; margin-bottom: 20px; border: 2px solid var(--text-dim); border-radius: 12px; padding: 15px; background-color: rgba(0,0,0,0.2); }
        .studio-header { font-weight: bold; color: var(--text-dim); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .studio-controls { display: flex; gap: 5px; margin-bottom: 10px; }
        .studio-select { flex: 1; background: #333; color: #eee; border: 1px solid #555; padding: 10px; border-radius: 6px; font-family: 'Segoe UI', sans-serif; font-size: 0.9em; min-width: 0;}
        .studio-btn { width: 90px; background: var(--text-dim); color: #222; border: none; padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer; white-space: nowrap; font-size: 0.8em; }
        .studio-textarea { width: 100%; min-height: 180px; background: rgba(0,0,0,0.2); border: 1px solid #444; color: #eee; font-family: 'Consolas', 'Segoe UI', sans-serif; padding: 10px; border-radius: 6px; resize: vertical; line-height: 1.6; font-size: 16px; box-sizing: border-box; }
        .studio-textarea:focus { outline: 1px solid var(--text-dim); }
        #braindom-box { border-color: var(--sub-2); } #braindom-box .studio-header { color: var(--sub-2); } #braindom-box .studio-btn { background-color: var(--sub-2); }
        #writer-box { border-color: var(--sub-1); } #writer-box .studio-header { color: var(--sub-1); } #writer-box .studio-btn { background-color: var(--sub-1); }

        /* --- BOTTOM DOCK --- */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px); border-top: 1px solid #444; z-index: 1000; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -4px 15px rgba(0,0,0,0.3); }
        .nav-item { background: transparent; border: none; color: #888; font-size: 20px; cursor: pointer; padding: 8px 15px; border-radius: 8px; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .nav-item:active { color: var(--main-color); transform: scale(0.9); }
        .nav-label { font-size: 10px; font-weight: bold; text-transform: uppercase; }

        /* --- GHOST ELEVATOR --- */
        .scroll-widget { position: fixed; bottom: 75px; right: 15px; z-index: 990; display: flex; flex-direction: column; gap: 10px; opacity: 0.3; transition: opacity 0.3s; }
        .scroll-widget:active, .scroll-widget:hover { opacity: 1; }
        .scroll-btn { width: 45px; height: 45px; border-radius: 50%; background: rgba(50, 50, 50, 0.9); backdrop-filter: blur(5px); border: 1px solid #666; color: #fff; font-size: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        /* --- MODAL UI (FIXED ALIGNMENT) --- */
        #edit-modal, #archive-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background-color: var(--bg-box); padding: 15px; border-radius: 10px; width: 95%; max-width: 1100px; display: flex; flex-direction: column; height: 90vh; }
        .modal-body { display: flex; flex: 1; gap: 15px; overflow: hidden; position: relative; }
        #editor-container { flex: 3; display: flex; gap: 10px; overflow: hidden; }
        #history-panel { flex: 1; border-left: 1px solid #444; padding-left: 10px; display: flex; flex-direction: column; overflow: hidden; }
        .editor-col { flex: 1; display: flex; flex-direction: column; }
        .editor-label { font-weight: bold; color: var(--sub-2); margin-bottom: 5px; display: block;}
        textarea { background-color: #111; color: #eee; border: 1px solid #555; padding: 10px; flex: 1; font-family: monospace; resize: none; margin-bottom: 10px; font-size: 16px; line-height: 1.6; box-sizing: border-box; }
        
        /* DATA CENTER BUTTONS (SMALL & PINK) */
        .data-center-row { 
            background: #222; padding: 10px; border-radius: 8px; border: 1px solid #444;
            display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px; margin-bottom: 10px;
            align-items: center; justify-content: center;
        }
        .btn-data { 
            background-color: var(--main-color); color: #4a2c2a; 
            border: none; font-weight: bold; padding: 8px 12px; font-size: 0.8em; 
            border-radius: 6px; cursor: pointer; text-transform: uppercase;
        }
        
        /* FOOTER ACTIONS (GRID LAYOUT) */
        .modal-actions { 
            margin-top: 5px; 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; /* 3 c·ªôt ƒë·ªÅu nhau */
            gap: 10px;
        }
        .btn-save { background-color: var(--check-bg); border: none; padding: 12px 0; cursor: pointer; font-weight: bold; border-radius: 6px; color: #333; width: 100%; font-size: 0.9em;}
        .btn-close { background-color: #444; border: 1px solid #666; color: #eee; padding: 12px 0; cursor: pointer; font-weight: bold; border-radius: 6px; width: 100%; font-size: 0.9em;}
        .btn-compare { background-color: var(--sub-3); border: none; padding: 12px 0; cursor: pointer; font-weight: bold; border-radius: 6px; color: #333; width: 100%; font-size: 0.9em;}
        
        .data-center-label { display: none; } /* Hide label on mobile to save space */

        #toast { visibility: hidden; min-width: 250px; background-color: var(--check-bg); color: #333; font-weight: bold; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 3000; left: 50%; bottom: 80px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        #restore-input { display: none; }
        #diff-view { flex: 1; background-color: #0d1117; border: 1px solid #444; padding: 15px; overflow-y: auto; font-family: monospace; font-size: 17px; line-height: 1.6; display: none; }
        .diff-line { padding: 2px 5px; border-bottom: 1px solid #222; white-space: pre-wrap; word-break: break-all; }
        .diff-added { background-color: var(--diff-add-bg); color: var(--diff-add-text); border-left: 3px solid var(--check-bg); }
        .diff-removed { background-color: var(--diff-rem-bg); color: var(--diff-rem-text); border-left: 3px solid var(--main-color); text-decoration: line-through; opacity: 0.7; }
        .diff-same { color: #666; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadein { from {bottom: 60px; opacity: 0;} to {bottom: 80px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 80px; opacity: 1;} to {bottom: 60px; opacity: 0;} }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); } 70% { box-shadow: 0 0 0 5px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
    </style>
</head>
<body>

    <div class="header-section">
        <div class="quote-card" id="daily-quote-card">
            <div class="quote-overlay"></div>
            <div class="quote-content">
                <div class="quote-text" id="quote-text"></div>
                <span class="quote-author" id="quote-author"></span>
            </div>
        </div>
        <div class="stats-container">
            <div class="stats-header">üìä NƒÇNG L∆Ø·ª¢NG & TI·∫æN ƒê·ªò</div>
            <div id="stats-content"></div>
        </div>
    </div>

    <div class="lam-reminder-bar" id="lam-bar">
        <span class="lam-icon">üë©‚Äçüíº</span>
        <span class="lam-label">Lam nh·∫Øn cho Meo:</span>
        <span class="lam-text" id="lam-msg">"..."</span>
    </div>

    <div id="dashboard-container"></div>

    <div id="braindom-box" class="studio-box">
        <div class="studio-header">üß† BRAINDOM STUDIO</div>
        <div class="studio-controls">
            <select id="braindom-action" class="studio-select">
                <option value="template">‚ûï Ch√®n M·∫´u (Vi·ªác/G·∫•p/Time)</option>
                <option value="copy">üìã Copy n·ªôi dung</option>
                <option value="clear">üóëÔ∏è X√≥a h·∫øt nh√°p</option>
            </select>
            <button class="studio-btn" onclick="executeBraindomAction()">TH·ª∞C HI·ªÜN</button>
        </div>
        <textarea id="brain-dump-area" class="studio-textarea" placeholder="ƒê·∫ßu √≥c ƒëang r·ªëi? N√©m h·∫øt v√†o ƒë√¢y... (T·ª± ƒë·ªông l∆∞u)"></textarea>
    </div>

    <div id="writer-box" class="studio-box">
        <div class="studio-header">üìñ WRITER'S STUDIO (G√ìC √ù T∆Ø·ªûNG VI·∫æT S√ÅCH)</div>
        <div class="studio-controls">
            <select id="writer-action" class="studio-select">
                <option value="idea">üíé Ch√®n: √ù t∆∞·ªüng th√¥</option>
                <option value="char">üë§ Ch√®n: H·ªì s∆° Nh√¢n v·∫≠t</option>
                <option value="chapter">üé¨ Ch√®n: C·∫•u tr√∫c Ch∆∞∆°ng</option>
                <option value="merge">üì• G·ªòP V√ÄO B·∫¢N TH·∫¢O CHUNG</option>
                <option value="view">üëÅÔ∏è XEM/S·ª¨A B·∫¢N TH·∫¢O</option>
                <option value="export">üíæ Xu·∫•t File .TXT</option>
            </select>
            <button class="studio-btn" onclick="executeWriterAction()">TH·ª∞C HI·ªÜN</button>
        </div>
        <textarea id="book-ideas-area" class="studio-textarea" placeholder="N∆°i nh·ªØng ki·ªát t√°c b·∫Øt ƒë·∫ßu..."></textarea>
    </div>

    <div id="toast">üéâ Xong th√™m 1 vi·ªác!</div>
    
    <div class="bottom-nav">
        <button class="nav-item" onclick="toggleTheme()"><span>üé®</span><span class="nav-label">Theme</span></button>
        <button class="nav-item" onclick="syncUp()"><span>‚òÅÔ∏è</span><span class="nav-label">Upload</span></button>
        <button class="nav-item" onclick="syncDown()"><span>üå®Ô∏è</span><span class="nav-label">Download</span></button>
        <button class="nav-item" onclick="openModal()"><span>‚öôÔ∏è</span><span class="nav-label">Setting</span></button>
    </div>

    <div class="scroll-widget">
        <button class="scroll-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚¨Ü</button>
        <button class="scroll-btn" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})">‚¨á</button>
    </div>

    <input type="file" id="restore-input" accept=".json" onchange="restoreData(this)">

    <div id="edit-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0; display:flex; justify-content:space-between;">
                <span>üìù C·∫¨P NH·∫¨T</span>
                <span style="font-size:0.6em; color:#666; font-weight:normal">D√πng Ctrl+Z n·∫øu x√≥a nh·∫ßm</span>
            </h3>
            <div class="modal-body">
                <div id="editor-container">
                    <div class="editor-col" id="col-old" style="display:none">
                        <span class="editor-label">üìÅ G·ªêC</span>
                        <textarea id="old-data" readonly style="opacity:0.7; border-style:dashed;"></textarea>
                    </div>
                    <div class="editor-col" id="col-new">
                        <span class="editor-label">‚úèÔ∏è M·ªöI</span>
                        <textarea id="input-data" placeholder="Paste data v√†o ƒë√¢y..."></textarea>
                        <div id="diff-view"></div>
                    </div>
                </div>
                <div id="history-panel">
                    <span class="editor-label" style="color:var(--pastel-peach)">üïí L·ªäCH S·ª¨</span>
                    <div id="history-list" class="history-list"></div>
                </div>
            </div>
            
            <div class="data-center-row">
                <button class="btn-data" onclick="backupFull(true)">üì§ BACKUP</button>
                <button class="btn-data" onclick="document.getElementById('restore-input').click()">üì• RESTORE</button>
                <button class="btn-data" onclick="exportCSV()">üìä EXPORT CSV</button>
            </div>
            
            <div class="modal-actions">
                <button class="btn-compare" onclick="toggleCompare()" id="btn-compare">So S√°nh</button>
                <button class="btn-close" onclick="closeModal()">ƒê√≥ng</button>
                <button class="btn-save" onclick="saveData()">L∆∞u</button>
            </div>
        </div>
    </div>

    <div id="archive-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0;">üìö B·∫¢N TH·∫¢O CHUNG</h3>
            <textarea id="archive-textarea" style="flex:1; background:#1a1a1a; color:#eee; border:1px solid #555; padding:15px; font-family:'Consolas', monospace; resize:none; font-size:16px; box-sizing: border-box;"></textarea>
            <div class="modal-actions">
                <button class="btn-data" onclick="exportMasterDraft()" style="border-color:var(--check-bg); color:var(--check-bg)">üíæ XU·∫§T .TXT</button>
                <button class="btn-close" onclick="document.getElementById('archive-modal').style.display='none'">ƒê√≥ng</button>
                <button class="btn-save" onclick="saveArchive()">L∆ØU</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const AIRTABLE = {
            PAT: 'patE1cRnlN0yvjW1y' + '.' + 'c084f80cf32df8ee63f63f22477ca64fb60ef67cfd61917776460ae282722b36',
            BASE_ID: 'app9cWP64Qbz0T1QT',
            TABLE_ID: 'tbluPfLWGE5oHVOqX',
            API_URL: `https://api.airtable.com/v0/app9cWP64Qbz0T1QT/tbluPfLWGE5oHVOqX`
        };
        const quotesDB = [{t:"Ch√∫ng ta ƒëau kh·ªï trong t∆∞·ªüng t∆∞·ª£ng nhi·ªÅu h∆°n l√† trong th·ª±c t·∫ø.",a:"Seneca"},{t:"K·ª∑ lu·∫≠t l√† l√†m nh·ªØng ƒëi·ªÅu b·∫°n gh√©t nh∆∞ th·ªÉ b·∫°n y√™u th√≠ch n√≥.",a:"Mike Tyson"},{t:"C√°ch t·ªët nh·∫•t ƒë·ªÉ d·ª± ƒëo√°n t∆∞∆°ng lai l√† t·∫°o ra n√≥.",a:"Peter Drucker"},{t:"T·∫≠p trung l√† ngh·ªá thu·∫≠t bi·∫øt n√≥i KH√îNG.",a:"Steve Jobs"},{t:"Kh√¥ng c√≥ √°p l·ª±c, kh√¥ng c√≥ kim c∆∞∆°ng.",a:"Thomas Carlyle"}];

        function initDailyQuote() {
            const today = new Date(); const start = new Date(today.getFullYear(),0,0); const diff = today-start; const oneDay = 1000*60*60*24;
            const dayOfYear = Math.floor(diff/oneDay); const quote = quotesDB[dayOfYear%quotesDB.length];
            document.getElementById('quote-text').innerHTML = `<span style="display:block; font-size:0.9em; margin-bottom:8px; color:var(--main-color);">Anh Meo √†,</span> "${quote.t}"`;
            document.getElementById('quote-author').textContent = `‚Äî ${quote.a}`;
            const myImages = ['5.jpg','6.jpg']; const randomImg = myImages[Math.floor(Math.random()*myImages.length)];
            document.getElementById('daily-quote-card').style.backgroundImage = `url('images/${randomImg}')`;
        }

        const defaultData = `!!! Lam ƒë√¢y! Timer ƒë√£ tr·ªü l·∫°i l·ª£i h·∫°i h∆°n x∆∞a!
# A. üî• URGENT
- [A-01] Mua b√∫t v·∫Ω | M√†u n∆∞·ªõc Winsor & Newton
- [A-02] Tham kh·∫£o web | https://google.com

# B. üåü CORE
- [B-01] Vi·∫øt content

# C. üß± FOUNDATION
- [C-01] H·ªçc ti·∫øng Anh

# D. üí§ KHO √ù T∆Ø·ªûNG / (L√ÄM KHI R·∫¢NH)
- [D-01] S·∫Øp x·∫øp l·∫°i t·ªß s√°ch`;

        function renderDashboard(text) {
            const container = document.getElementById('dashboard-container'); container.innerHTML = '';
            const lines = text.split('\n'); let currentBox, currentList; let currentTaskItem = null;

            lines.forEach(line => {
                let trimmedLine = line.trim(); if (!trimmedLine) return;
                if (trimmedLine.startsWith('!!!')) { document.getElementById('lam-msg').textContent = trimmedLine.replace('!!!','').trim(); return; }
                
                if (trimmedLine.startsWith('^')) {
                    if (currentTaskItem) {
                        let content = trimmedLine.substring(1).trim();
                        if (content.match(/https?:\/\//)) content = content.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
                        let noteBox = currentTaskItem.querySelector('.task-note-box');
                        if (!noteBox) {
                            currentTaskItem.insertAdjacentHTML('beforeend', `<div class="task-note-box"></div>`);
                            noteBox = currentTaskItem.querySelector('.task-note-box');
                            currentTaskItem.querySelector('.btn-note-toggle').classList.add('has-content');
                        }
                        noteBox.innerHTML += `<span class="note-line">${content}</span>`;
                    }
                    return;
                }

                if (trimmedLine.startsWith('#')) {
                    currentTaskItem = null;
                    const title = trimmedLine.replace('#','').trim();
                    const h2 = document.createElement('h2'); h2.textContent = title; container.appendChild(h2);
                    currentBox = document.createElement('div'); currentBox.className = 'box';
                    currentBox.setAttribute('data-type', title.toUpperCase()); 
                    
                    const safeId = title.replace(/\s/g,'').replace(/[^a-zA-Z0-9]/g,'');
                    const loggerHTML = `
                        <div class="time-logger-bar">
                            <input type="text" class="logger-input-code" placeholder="CODE" id="log-code-${safeId}">
                            <input type="number" class="logger-input-time" placeholder="Min" id="log-time-${safeId}" onkeydown="if(event.key==='Enter') quickLog('${safeId}')">
                            <button class="logger-btn" onclick="quickLog('${safeId}')">LOG</button>
                            <button class="timer-btn" onclick="startTimer(this, 1)">1'</button>
                            <button class="timer-btn" onclick="startTimer(this, 15)">15'</button>
                        </div>
                    `;
                    currentBox.innerHTML = loggerHTML;
                    
                    container.appendChild(currentBox);
                    currentList = document.createElement('ul'); currentList.className = 'task-list'; currentBox.appendChild(currentList);
                } 
                else if (trimmedLine.startsWith('-')) {
                    if (currentList) {
                        let level = 1; if (trimmedLine.startsWith('---')) level = 3; else if (trimmedLine.startsWith('--')) level = 2;
                        let parts = trimmedLine.replace(/^-+/, '').split('|');
                        let rawText = parts[0].trim();
                        let inlineNote = parts.length > 1 ? parts[1].trim() : "";
                        
                        let displayHTML = rawText;
                        let taskIdRaw = stringToHash(rawText);
                        let idTagHTML = "";
                        const idMatch = rawText.match(/^\[([A-Za-z0-9-]+)\]/);
                        
                        if (idMatch) {
                            const fullTag = idMatch[0]; 
                            const cleanCode = idMatch[1]; 
                            const restOfText = rawText.substring(fullTag.length).trim();
                            idTagHTML = `<span class="task-id-tag" onclick="fillLogger(this, '${cleanCode}')">${fullTag}</span>`;
                            let noteBtnClass = inlineNote ? "has-content" : "";
                            let noteBtnHTML = `<button class="btn-note-toggle ${noteBtnClass}" onclick="toggleTaskNote(this)">üìù</button>`;
                            displayHTML = `${idTagHTML}${noteBtnHTML} <span class="main-text">${restOfText}</span>`;
                        } else {
                            displayHTML = `<span class="main-text">${rawText}</span>`;
                        }

                        let noteBoxHTML = "";
                        if (inlineNote) {
                            if (inlineNote.match(/^https?:\/\//)) inlineNote = `<a href="${inlineNote}" target="_blank">üîó ${inlineNote}</a>`;
                            noteBoxHTML = `<div class="task-note-box"><span class="note-line">${inlineNote}</span></div>`;
                        }

                        const taskId = 'task-' + taskIdRaw;
                        const totalTime = getTotalTime(taskId);
                        const timeBadge = totalTime > 0 ? `<span class="total-time-badge">(${totalTime}')</span>` : ``;

                        const li = document.createElement('li');
                        li.className = `task-item indent-${level}`;
                        li.setAttribute('data-id', taskId);
                        
                        let toggleHTML = '<span class="spacer"></span>';

                        li.innerHTML = `
                            <span class="toggle-placeholder">${toggleHTML}</span>
                            <input type="checkbox" id="${taskId}" onclick="checkTask(this)">
                            <label for="${taskId}" class="task-label">${displayHTML} ${timeBadge}
                                <div class="mini-progress-container"><div class="mini-progress-fill"></div></div>
                            </label>
                            ${noteBoxHTML}
                        `;
                        currentList.appendChild(li);
                        currentTaskItem = li;
                        if(localStorage.getItem(taskId) === "true") li.querySelector('input').checked = true;
                    }
                }
            });
            initFolding(container); calculateStats(); 
        }

        function fillLogger(span, code) {
            const box = span.closest('.box');
            if(box) {
                const inputCode = box.querySelector('.logger-input-code');
                const inputTime = box.querySelector('.logger-input-time');
                if(inputCode) { inputCode.value = code; inputTime.focus(); }
            }
        }

        function quickLog(boxId) {
            const inputCode = document.getElementById(`log-code-${boxId}`);
            const inputTime = document.getElementById(`log-time-${boxId}`);
            const code = inputCode.value.trim();
            const minutes = parseInt(inputTime.value);

            if (!code || isNaN(minutes) || minutes <= 0) { alert("Vui l√≤ng nh·∫≠p M√£ Task v√† S·ªë ph√∫t!"); return; }
            logToTaskByCode(code, minutes);
            inputTime.value = '';
        }

        function logToTaskByCode(code, minutes) {
            const allTags = document.querySelectorAll('.task-id-tag');
            let foundTaskId = null;
            allTags.forEach(tag => {
                if (tag.innerText.includes(code)) {
                    foundTaskId = tag.closest('.task-item').getAttribute('data-id');
                }
            });

            if (foundTaskId) {
                logTime(foundTaskId, minutes);
                const data = localStorage.getItem('dashboardData') || defaultData;
                renderDashboard(data);
            } else { alert("‚ùå Kh√¥ng t√¨m th·∫•y Task c√≥ m√£: " + code); }
        }

        let activeInterval, audioCtx;
        function playBeep() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type = 'sine'; o.frequency.setValueAtTime(800, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.5); g.gain.setValueAtTime(0.5, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5); o.start(); o.stop(audioCtx.currentTime + 0.5); }

        function startTimer(btn, minutes) {
            if (activeInterval) clearInterval(activeInterval);
            document.querySelectorAll('.timer-btn').forEach(b => { 
                b.classList.remove('timer-running'); 
                if(b.dataset.orgText) b.innerText = b.dataset.orgText; 
                b.disabled = false; 
            }); 
            
            if(!btn.dataset.orgText) btn.dataset.orgText = btn.innerText; 
            let seconds = minutes * 60; 
            btn.classList.add('timer-running'); btn.disabled = true; 
            
            function update() { 
                let m = Math.floor(seconds / 60); let s = seconds % 60; 
                btn.innerText = `${m}:${s < 10 ? '0' : ''}${s}`; 
                if (seconds < 0) { 
                    clearInterval(activeInterval); 
                    btn.innerText = "DONE"; 
                    playBeep(); setTimeout(playBeep, 600); setTimeout(playBeep, 1200); 
                    setTimeout(() => { 
                        btn.classList.remove('timer-running'); 
                        btn.innerText = btn.dataset.orgText; 
                        btn.disabled = false; 
                    }, 3000); 
                } 
                seconds--; 
            } 
            update(); activeInterval = setInterval(update, 1000); 
        }

        function toggleTaskNote(btn) {
            const item = btn.closest('.task-item');
            const noteBox = item.querySelector('.task-note-box');
            if (noteBox) {
                if (noteBox.classList.contains('show')) noteBox.classList.remove('show');
                else noteBox.classList.add('show');
            }
        }

        function executeBraindomAction() {
            const action = document.getElementById('braindom-action').value;
            if (action === 'template') insertBDTemplate();
            else if (action === 'copy') copyBrainDump();
            else if (action === 'clear') clearBrainDump();
        }

        function executeWriterAction() {
            const action = document.getElementById('writer-action').value;
            if (action === 'merge') mergeToMasterDraft();
            else if (action === 'view') openArchiveModal();
            else if (action === 'export') exportBookTxt();
            else insertBookTemplate(action);
        }

        // --- CORE FUNCTIONS ---
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'classic' ? '' : 'classic'); localStorage.setItem('theme', document.body.getAttribute('data-theme')); }
        function saveBrainDump() { localStorage.setItem('zetmeo_braindump', document.getElementById('brain-dump-area').value); }
        function loadBrainDump() { document.getElementById('brain-dump-area').value = localStorage.getItem('zetmeo_braindump') || ''; }
        function insertBDTemplate() { document.getElementById('brain-dump-area').value += `\n\n--- KHO NH√ÅP ---\n- [Vi·ªác] \n- [?] `; saveBrainDump(); }
        function copyBrainDump() { navigator.clipboard.writeText(document.getElementById('brain-dump-area').value); alert("ƒê√£ copy!"); }
        function clearBrainDump() { if(confirm('X√≥a?')) { document.getElementById('brain-dump-area').value = ""; saveBrainDump(); } }
        function saveBookIdeas() { localStorage.setItem('zetmeo_book_draft_current', document.getElementById('book-ideas-area').value); }
        function loadBookIdeas() { document.getElementById('book-ideas-area').value = localStorage.getItem('zetmeo_book_draft_current') || ''; }
        function insertBookTemplate(type) { document.getElementById('book-ideas-area').value += (type==='char' ? `\nüë§ Nh√¢n v·∫≠t:` : (type==='chapter' ? `\nüé¨ Ch∆∞∆°ng:` : `\nüíé √ù t∆∞·ªüng:`)); saveBookIdeas(); }
        function mergeToMasterDraft() { 
            const cur = document.getElementById('book-ideas-area').value.trim(); if(!cur) return;
            if(confirm("G·ªôp?")) { localStorage.setItem('zetmeo_book_master', (localStorage.getItem('zetmeo_book_master')||"") + "\n\n--- " + new Date().toLocaleString() + " ---\n" + cur); document.getElementById('book-ideas-area').value=""; saveBookIdeas(); alert("ƒê√£ g·ªôp!"); }
        }
        function openArchiveModal() { document.getElementById('archive-textarea').value = localStorage.getItem('zetmeo_book_master')||""; document.getElementById('archive-modal').style.display='flex'; }
        function saveArchive() { localStorage.setItem('zetmeo_book_master', document.getElementById('archive-textarea').value); document.getElementById('archive-modal').style.display='none'; }
        
        function exportMasterDraft() {
            const content = document.getElementById('archive-textarea').value;
            const blob = new Blob(["\uFEFF" + content], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            const date = new Date().toISOString().slice(0,10);
            link.setAttribute("href", url);
            link.setAttribute("download", `Zetmeo_MASTER_DRAFT_${date}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function checkTask(cb) { localStorage.setItem(cb.id, cb.checked); calculateStats(); if(cb.checked) { document.getElementById('toast').className="show"; setTimeout(()=>document.getElementById('toast').className="",2000);} }
        
        function calculateStats() {
            const statsContainer = document.getElementById('stats-content'); statsContainer.innerHTML = ''; 
            const boxes = document.querySelectorAll('.box'); updateMiniProgressBars();
            const totalBoxes = boxes.length; if (totalBoxes === 0) return;
            const weightPerBox = 100 / totalBoxes; let totalGlobalProgress = 0;
            boxes.forEach(box => {
                const title = box.getAttribute('data-type'); const checkboxes = box.querySelectorAll('input[type="checkbox"]');
                const totalTasks = checkboxes.length; const checkedTasks = box.querySelectorAll('input[type="checkbox"]:checked').length;
                let localPercent = totalTasks > 0 ? (checkedTasks / totalTasks) * 100 : 0;
                const globalContribution = (localPercent / 100) * weightPerBox; totalGlobalProgress += globalContribution;
                let barColorClass = 'bar-core'; if (title.includes('URGENT')) barColorClass = 'bar-urgent'; else if (title.includes('FOUNDATION')) barColorClass = 'bar-foundation';
                const row = document.createElement('div'); row.className = 'stat-row';
                row.innerHTML = `<div class="stat-label"><span>${title} <span style="color:#777; font-size:0.85em">(${weightPerBox.toFixed(0)}%)</span></span><span>${Math.round(localPercent)}%</span></div><div class="stat-bar-bg"><div class="stat-bar-fill ${barColorClass}" style="width: ${localPercent}%"></div></div>`;
                statsContainer.appendChild(row);
            });
            const globalRow = document.createElement('div'); globalRow.className = 'stat-row'; globalRow.style.marginTop = "15px"; globalRow.style.paddingTop = "15px"; globalRow.style.borderTop = "1px solid #333";
            globalRow.innerHTML = `<div class="stat-label"><span style="color: var(--sub-3); font-weight:bold">üöÄ TI·∫æN ƒê·ªò NƒÇM 2026</span><span style="color: var(--sub-3); font-weight:bold">${totalGlobalProgress.toFixed(1)}%</span></div><div class="stat-bar-bg" style="height:12px; border: 1px solid #555"><div class="stat-bar-fill bar-total" style="width: ${totalGlobalProgress}%"></div></div>`;
            statsContainer.insertBefore(globalRow, statsContainer.firstChild);
        }

        function updateMiniProgressBars() {
            const taskLists = document.querySelectorAll('.task-list');
            taskLists.forEach(list => {
                const items = Array.from(list.children);
                items.forEach((item, index) => {
                    const currentLevel = parseInt(item.getAttribute('data-level')||1);
                    let childCount = 0; let childChecked = 0; let hasChildren = false;
                    for (let i = index + 1; i < items.length; i++) {
                        const child = items[i]; const childLevel = parseInt(child.getAttribute('data-level')||1);
                        if (childLevel <= currentLevel) break;
                        hasChildren = true; childCount++;
                        if (child.querySelector('input').checked) childChecked++;
                    }
                    if (hasChildren) {
                        item.classList.add('has-children');
                        const percent = Math.round((childChecked / childCount) * 100);
                        const fill = item.querySelector('.mini-progress-fill');
                        if (fill) fill.style.width = percent + '%';
                    } else { item.classList.remove('has-children'); }
                });
            });
        }

        function initFolding(container) {
            const lists = container.querySelectorAll('.task-list');
            lists.forEach(list => {
                const items = Array.from(list.children);
                items.forEach((item, index) => {
                    const currentLevel = parseInt(item.getAttribute('data-level')||1);
                    const nextItem = items[index + 1]; const nextLevel = nextItem ? parseInt(nextItem.getAttribute('data-level')||1) : 0;
                    const placeholder = item.querySelector('.toggle-placeholder');
                    if (nextItem && nextLevel > currentLevel) {
                        placeholder.innerHTML = '‚ñ∂'; placeholder.className = 'toggle-btn';
                        const isExpanded = localStorage.getItem('fold-' + item.getAttribute('data-id')) === 'true';
                        if (isExpanded) { placeholder.classList.add('rotated'); placeholder.innerHTML = '‚ñº'; }
                        placeholder.onclick = function() { toggleChildren(items, index, currentLevel, this, item.getAttribute('data-id')); };
                        if (!isExpanded) hideChildren(items, index, currentLevel);
                    } else { placeholder.className = 'spacer'; }
                });
            });
        }
        function toggleChildren(allItems, parentIndex, parentLevel, btn, parentId) {
            const isCollapsing = btn.classList.contains('rotated');
            if (isCollapsing) { btn.classList.remove('rotated'); btn.innerHTML = '‚ñ∂'; localStorage.setItem('fold-' + parentId, 'false'); hideChildren(allItems, parentIndex, parentLevel); } 
            else { btn.classList.add('rotated'); btn.innerHTML = '‚ñº'; localStorage.setItem('fold-' + parentId, 'true'); showChildren(allItems, parentIndex, parentLevel); }
        }
        function hideChildren(allItems, parentIndex, parentLevel) { for (let i = parentIndex + 1; i < allItems.length; i++) { const item = allItems[i]; if (parseInt(item.getAttribute('data-level')||1) <= parentLevel) break; item.classList.add('hidden-task'); } }
        function showChildren(allItems, parentIndex, parentLevel) {
            for (let i = parentIndex + 1; i < allItems.length; i++) {
                const item = allItems[i]; const level = parseInt(item.getAttribute('data-level')||1); if (level <= parentLevel) break; item.classList.remove('hidden-task');
                const toggleBtn = item.querySelector('.toggle-btn');
                if (toggleBtn && !toggleBtn.classList.contains('rotated')) { let subParentLevel = level; let j = i + 1; while(j < allItems.length) { if(parseInt(allItems[j].getAttribute('data-level')||1) <= subParentLevel) break; j++; } i = j - 1; }
            }
        }

        function getLogs() { return JSON.parse(localStorage.getItem('zetmeo_time_logs') || '{}'); }
        function logTime(id, min) { let l=getLogs(); if(!l[id]) l[id]=[]; l[id].push({date:new Date().toISOString(), min:min}); localStorage.setItem('zetmeo_time_logs',JSON.stringify(l)); document.getElementById('toast').innerText=`ƒê√£ ghi ${min}p!`; document.getElementById('toast').className="show"; setTimeout(()=>document.getElementById('toast').className="",3000); }
        function getTotalTime(id) { let l=getLogs(); return l[id] ? l[id].reduce((a,b)=>a+b.min,0) : 0; }
        function stringToHash(s) { let h=0; for(let i=0;i<s.length;i++) h=Math.abs(((h<<5)-h)+s.charCodeAt(i)); return h; }
        
        // --- CLOUD SYNC & EXPORT & BACKUP ---
        async function getRecordID() {
            let recordId = localStorage.getItem('zetmeo_cloud_record_id');
            if (recordId) return recordId;
            try {
                const response = await fetch(AIRTABLE.API_URL, {
                    headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}` }
                });
                const data = await response.json();
                if (data.records && data.records.length > 0) {
                    recordId = data.records[0].id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                } else {
                    const createResponse = await fetch(AIRTABLE.API_URL, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ fields: { "Data": "{}" } })
                    });
                    const createData = await createResponse.json();
                    recordId = createData.id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                }
            } catch (error) { return null; }
        }
        async function syncUp() { 
            if(!confirm("Upload?")) return; 
            const btn = document.querySelectorAll('.nav-item')[1]; const oldText = btn.innerHTML; btn.innerHTML = "<span>‚è≥</span><span class='nav-label'>Wait...</span>";
            const rid = await getRecordID(); if(!rid) return;
            fetch(`${AIRTABLE.API_URL}/${rid}`, {method:'PATCH', headers:{'Authorization':`Bearer ${AIRTABLE.PAT}`,'Content-Type':'application/json'}, body:JSON.stringify({fields:{"Data":JSON.stringify(localStorage)}})})
            .then(r=>r.ok?alert("‚úÖ OK"):alert("L·ªói")).finally(()=>btn.innerHTML=oldText);
        }
        async function syncDown() {
            if(!confirm("Download?")) return;
            const btn = document.querySelectorAll('.nav-item')[2]; const oldText = btn.innerHTML; btn.innerHTML = "<span>‚è≥</span><span class='nav-label'>Wait...</span>";
            const rid = await getRecordID(); if(!rid) return;
            fetch(`${AIRTABLE.API_URL}/${rid}`, {headers:{'Authorization':`Bearer ${AIRTABLE.PAT}`}}).then(r=>r.json()).then(d=>{
                if(d.fields.Data) { const l=JSON.parse(d.fields.Data); localStorage.clear(); Object.keys(l).forEach(k=>localStorage.setItem(k,l[k])); location.reload(); }
            }).finally(()=>btn.innerHTML=oldText);
        }
        
        function backupFull(isManual=false) {
            const backup = JSON.stringify(localStorage);
            const blob = new Blob([backup], { type: 'application/json' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
            link.setAttribute("href", url);
            link.setAttribute("download", `ZetmeoOS_Backup_${dateStr}.json`);
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
            if (isManual) alert("‚úÖ ƒê√£ sao l∆∞u d·ªØ li·ªáu!");
        }

        function restoreData(input) {
            const file = input.files[0]; if (!file) return;
            if(!confirm("Ghi ƒë√® d·ªØ li·ªáu?")) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.clear();
                    Object.keys(data).forEach(key => { localStorage.setItem(key, data[key]); });
                    alert("‚úÖ Kh√¥i ph·ª•c th√†nh c√¥ng!"); location.reload();
                } catch (error) { alert("‚ùå L·ªói file!"); }
            };
            reader.readAsText(file);
        }

        function exportCSV() {
            let logs = getLogs();
            let csvContent = "Category,Task ID,Task Name,Date,Time (Minutes)\n";
            const taskMap = {}; 
            const boxes = document.querySelectorAll('.box');
            boxes.forEach(box => {
                const category = box.getAttribute('data-type');
                const taskItems = box.querySelectorAll('.task-item');
                taskItems.forEach(item => {
                    const id = item.getAttribute('data-id');
                    const label = item.querySelector('.task-label').innerText;
                    taskMap[id] = { name: label, category: category };
                });
            });
            for (const [taskId, logArray] of Object.entries(logs)) {
                const taskData = taskMap[taskId] || { name: "Deleted Task", category: "UNKNOWN" };
                logArray.forEach(log => {
                    const dateStr = new Date(log.date).toLocaleString();
                    const safeName = `"${taskData.name.replace(/"/g, '""')}"`;
                    csvContent += `"${taskData.category}",${taskId},${safeName},${dateStr},${log.min}\n`;
                });
            }
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `Zetmeo_TimeLog_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link); link.click(); document.body.removeChild(link);
        }

        function openModal(){ document.getElementById('input-data').value=localStorage.getItem('dashboardData')||defaultData; document.getElementById('edit-modal').style.display='flex'; }
        function closeModal(){ document.getElementById('edit-modal').style.display='none'; }
        function saveData(){ localStorage.setItem('dashboardData', document.getElementById('input-data').value); renderDashboard(document.getElementById('input-data').value); closeModal(); }
        function toggleCompare() {
            const btn = document.getElementById('btn-compare'); const colOld = document.getElementById('col-old'); const inputArea = document.getElementById('input-data'); const diffView = document.getElementById('diff-view'); const historyPanel = document.getElementById('history-panel');
            if (inputArea.style.display !== 'none') {
                btn.innerText = "üëÅÔ∏è EDIT"; btn.style.background = "#fff";
                colOld.style.display = 'flex'; inputArea.style.display = 'none'; diffView.style.display = 'block'; historyPanel.style.display = 'none';
                diffView.innerHTML = generateDiffHtml(document.getElementById('old-data').value, inputArea.value);
            } else {
                btn.innerText = "So S√°nh"; btn.style.background = "var(--sub-3)";
                colOld.style.display = 'none'; inputArea.style.display = 'block'; diffView.style.display = 'none'; historyPanel.style.display = 'flex';
            }
        }
        function generateDiffHtml(oldText, newText) {
            const oldLines = oldText.split('\n').map(l => l.trim()).filter(l => l); const newLines = newText.split('\n').map(l => l.trim()).filter(l => l);
            let html = ''; newLines.forEach(line => { if (oldLines.includes(line)) html += `<div class="diff-line diff-same">${line}</div>`; else html += `<div class="diff-line diff-added">+ ${line}</div>`; });
            let removedHtml = ''; oldLines.forEach(line => { if (!newLines.includes(line)) removedHtml += `<div class="diff-line diff-removed">- ${line}</div>`; });
            return html + (removedHtml ? `<div style="margin-top:10px; border-top:1px dashed #555; padding-top:5px; font-size:0.8em; color:#888">ƒê√É X√ìA:</div>` + removedHtml : '');
        }

        window.onload = function() { 
            const data = localStorage.getItem('dashboardData') || defaultData; 
            document.getElementById('old-data').value = data;
            renderDashboard(data);
            initDailyQuote(); 
            if (localStorage.getItem('theme') === 'classic') document.body.setAttribute('data-theme', 'classic');
            initAutoBackupScheduler();
            loadBrainDump(); 
            loadBookIdeas(); 
            document.getElementById('brain-dump-area').addEventListener('input', saveBrainDump);
            document.getElementById('book-ideas-area').addEventListener('input', saveBookIdeas); 
        }
    </script>
</body>
</html>
