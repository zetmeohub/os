<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>zetmeoOS - Dashboard 28.0 (Mobile UX)</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="zetmeoOS">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/96/check-all--v1.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/check-all--v1.png">

    <style>
        :root {
            /* --- C·∫§U H√åNH CHUNG --- */
            --bg-body: #232323; --bg-box: #2d2d2d;
            --text-main: #fcfcfc; --text-dim: #b0b0b0;
            --transition-speed: 0.3s;

            /* --- THEME 1: PASTEL --- */
            --main-color: #FF90BC; --sub-1: #FFC0D9; --sub-2: #F9F9E0; --sub-3: #8ACDD7;
            --check-bg: #ABE7B2; --check-tick: #444;
            
            /* COLORS FOR BOXES */
            --col-urgent: #FF90BC;
            --col-core: #8ACDD7;
            --col-found: #FFC0D9;
            --col-kho: #95a5a6;

            --diff-add-bg: rgba(46, 160, 67, 0.15); --diff-add-text: #7ee787;
            --diff-rem-bg: rgba(248, 81, 73, 0.15); --diff-rem-text: #ff7b72;
            --book-border: #FFC0D9; --book-bg: rgba(255, 192, 217, 0.05);
        }

        /* --- THEME 2: CLASSIC --- */
        [data-theme="classic"] {
            --main-color: #ffadad; --sub-1: #e0bbe4; --sub-2: #ffdac1; --sub-3: #a0c4ff;
            --check-bg: #4cd137; --check-tick: #fff;
            --col-urgent: #ff6b6b; --col-core: #48dbfb; --col-found: #feca57; --col-kho: #b2bec3;
            --book-border: #a0c4ff; --book-bg: rgba(160, 196, 255, 0.05);
        }

        body {
            background-color: var(--bg-body); color: var(--text-main);
            font-family: 'Consolas', 'Segoe UI', sans-serif;
            padding: 20px; max-width: 900px; margin: 0 auto; line-height: 1.6;
            padding-bottom: 120px; transition: all var(--transition-speed);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER & QUOTE --- */
        .header-section { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; margin-bottom: 25px; min-height: 220px; }
        
        .quote-card {
            background-color: #222; border-radius: 12px; border: 2px solid var(--main-color);
            position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            display: flex; flex-direction: column; justify-content: flex-end; padding: 25px;
            background-size: cover; background-position: center; transition: border-color var(--transition-speed);
        }
        .quote-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.3)); z-index: 1; }
        .quote-content { position: relative; z-index: 2; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        .quote-text { font-size: 1.2em; font-weight: bold; font-style: italic; line-height: 1.4; margin-bottom: 15px; font-family: 'Georgia', serif; }
        .quote-author { font-size: 0.85em; color: var(--sub-2); text-align: right; display: block; }

        @media (max-width: 700px) { 
            .header-section { grid-template-columns: 1fr; } 
            .quote-card {
                aspect-ratio: 1 / 1; width: 100%; min-height: unset;
                box-sizing: border-box; /* FIX TR√ÄN LAYOUT */
            }
        }

        .stats-container { background-color: #1a1e24; border: 1px solid #444; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .stats-header { color: var(--sub-3); font-weight: bold; margin-bottom: 15px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; font-size: 0.9em; }
        .stat-row { margin-bottom: 12px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; }
        .stat-bar-bg { background-color: #333; height: 8px; border-radius: 4px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        
        .lam-reminder-bar {
            background-color: var(--main-color); color: #4a2c2a; padding: 15px 25px;
            border-radius: 12px; border: 2px solid rgba(255,255,255,0.3); font-weight: bold;
            display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 40px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 1.05em;
        }
        .lam-icon { margin-right: 10px; font-size: 1.5em; animation: bounce 2s infinite; }
        .lam-label { margin-right: 10px; text-transform: uppercase; font-size: 0.75em; letter-spacing: 1px; background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 6px; }

        /* --- BOX STYLES & DYNAMIC COLORS --- */
        .box { 
            border: 1px solid #444; background-color: var(--bg-box); padding: 20px; 
            border-radius: 10px; margin-bottom: 20px; position: relative;
        }
        
        /* Define colors per box type */
        .box[data-type*="URGENT"] { border-left: 6px solid var(--col-urgent); --box-color: var(--col-urgent); } 
        .box[data-type*="CORE"] { border-left: 6px solid var(--col-core); --box-color: var(--col-core); } 
        .box[data-type*="FOUNDATION"] { border-left: 6px solid var(--col-found); --box-color: var(--col-found); } 
        .box[data-type*="KHO"] { border-left: 6px solid var(--col-kho); opacity: 0.8; --box-color: var(--col-kho); }

        h2 { 
            color: var(--box-color, #fff); /* Title match border color */
            margin-top: 0; margin-bottom: 10px; padding-bottom: 10px; 
            border-bottom: 1px dashed #555; font-size: 1.4em;
        }

        /* --- TIME LOGGER BAR (NEW) --- */
        .time-logger-bar {
            display: flex; align-items: center; gap: 5px; margin-bottom: 15px;
            background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px;
            border: 1px solid #444;
        }
        .logger-input-code { 
            width: 70px; background: transparent; border: 1px solid #555; color: var(--box-color); 
            font-weight: bold; text-align: center; padding: 5px; border-radius: 4px; font-family: monospace;
        }
        .logger-input-time { 
            width: 50px; background: transparent; border: 1px solid #555; color: #fff; 
            text-align: center; padding: 5px; border-radius: 4px; 
        }
        .logger-btn {
            background-color: var(--box-color); color: #333; border: none;
            padding: 6px 12px; border-radius: 4px; font-weight: bold; cursor: pointer;
            flex: 1; text-transform: uppercase; font-size: 0.8em;
        }

        .note { font-size: 0.9em; color: var(--text-dim); margin-bottom: 15px; font-style: italic; display: block; }
        
        /* --- TASK LIST STYLES (UPDATED) --- */
        .task-list { list-style: none; padding: 0; }
        .task-item { 
            margin-bottom: 10px; /* TƒÉng kho·∫£ng c√°ch */
            display: flex; align-items: flex-start; /* CƒÉn l·ªÅ tr√™n ƒë·ªÉ text d√†i kh√¥ng b·ªã x·∫•u */
            padding: 12px 10px; /* TƒÉng padding */
            border-radius: 6px; border-bottom: 1px solid #3d3d3d; 
            transition: all 0.2s; background-color: rgba(255,255,255,0.02);
        }
        .task-item:hover { background-color: #383838; }
        
        .indent-1 { margin-left: 0px; } 
        .indent-2 { margin-left: 20px; border-left: 2px solid #555; } 
        .indent-3 { margin-left: 40px; border-left: 2px solid #666; }
        
        .task-item input[type="checkbox"] { 
            appearance: none; width: 22px; height: 22px; 
            border: 2px solid var(--text-dim); border-radius: 50%; margin-right: 12px; 
            cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
            margin-top: 2px; /* CƒÉn ch·ªânh v·ªõi d√≤ng ƒë·∫ßu ti√™n c·ªßa text */
        }
        .task-item input:checked { background-color: var(--check-bg); border-color: var(--check-bg); }
        .task-item input:checked::after { content: '‚úî'; color: #333; font-size: 14px; font-weight: bold; }
        
        .task-label { 
            flex: 1; margin-right: 5px; cursor: pointer; position: relative; 
            line-height: 1.5; font-size: 1.05em; /* TƒÉng c·ª° ch·ªØ */
            color: #ececec; /* M√†u ch·ªØ s√°ng h∆°n */
        } 
        
        /* Task ID Tag (ƒê·ªìng b·ªô m√†u) */
        .task-id-tag { 
            font-family: 'Consolas', monospace; font-size: 0.85em; font-weight: bold; 
            padding: 2px 6px; border-radius: 4px; margin-right: 6px; 
            color: #111; display: inline-block; 
            background-color: var(--box-color, #ccc); /* Dynamic Color */
        }
        
        .btn-note-toggle { 
            border: none; background: transparent; padding: 0 5px; 
            cursor: pointer; color: #777; font-size: 1em; display: inline-block;
        }
        .btn-note-toggle.has-content { color: var(--box-color); } /* Dynamic Color */

        .task-item input:checked + .task-label { text-decoration: line-through; color: #666; }
        .task-item input:checked + .task-label .task-id-tag { opacity: 0.3; filter: grayscale(100%); }
        
        /* Task Note Box */
        .task-note-box { 
            display: none; width: 100%; margin-top: 8px; 
            background-color: var(--bg-body); padding: 8px 12px; 
            border-radius: 4px; border-left: 3px solid var(--box-color); /* Dynamic Color */
            font-size: 0.9em; color: #ccc; 
        }
        .task-note-box.show { display: block; animation: slideDown 0.2s; }

        /* Total Time Badge */
        .total-time-badge { font-size: 0.75em; color: var(--box-color); opacity: 0.8; margin-left: 5px; font-weight: normal; }

        /* --- BRAINDOM & WRITER STUDIO (UNIFIED STYLES) --- */
        .studio-box {
            margin-top: 30px; margin-bottom: 20px; 
            border: 2px solid var(--text-dim); border-radius: 12px;
            padding: 20px; background-color: rgba(0,0,0,0.2);
        }
        .studio-header { font-weight: bold; color: var(--text-dim); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        
        /* CONTROL BAR (DROPDOWN + BUTTON) */
        .studio-controls { display: flex; gap: 10px; margin-bottom: 10px; }
        .studio-select {
            flex: 2; background: #333; color: #eee; border: 1px solid #555;
            padding: 10px; border-radius: 6px; font-family: 'Segoe UI', sans-serif;
        }
        .studio-btn {
            flex: 1; background: var(--text-dim); color: #222; border: none;
            padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer;
        }
        
        .studio-textarea {
            width: 100%; min-height: 150px; background: rgba(0,0,0,0.2); 
            border: 1px solid #444; color: #eee; font-family: 'Consolas', 'Segoe UI', sans-serif; 
            padding: 15px; border-radius: 6px; resize: vertical; line-height: 1.6; font-size: 16px;
            box-sizing: border-box;
        }
        .studio-textarea:focus { outline: 1px solid var(--text-dim); }

        /* Specific Colors */
        #braindom-box { border-color: var(--sub-2); }
        #braindom-box .studio-header { color: var(--sub-2); }
        #braindom-box .studio-btn { background-color: var(--sub-2); }
        
        #writer-box { border-color: var(--sub-1); }
        #writer-box .studio-header { color: var(--sub-1); }
        #writer-box .studio-btn { background-color: var(--sub-1); }

        /* --- BOTTOM DOCK --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: rgba(30, 30, 30, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid #444; z-index: 1000;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.3);
        }
        .nav-item {
            background: transparent; border: none; color: #888;
            font-size: 20px; cursor: pointer; padding: 10px 20px;
            border-radius: 8px; transition: all 0.2s;
            display: flex; flex-direction: column; align-items: center; gap: 2px;
        }
        .nav-item:active { color: var(--main-color); transform: scale(0.9); }
        .nav-label { font-size: 10px; font-weight: bold; text-transform: uppercase; }

        /* --- GHOST ELEVATOR --- */
        .scroll-widget {
            position: fixed; bottom: 75px; right: 15px; z-index: 990;
            display: flex; flex-direction: column; gap: 8px;
            opacity: 0.3; transition: opacity 0.3s;
        }
        .scroll-widget:active, .scroll-widget:hover { opacity: 1; }
        .scroll-btn {
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(50, 50, 50, 0.9); backdrop-filter: blur(5px);
            border: 1px solid #666; color: #fff; font-size: 18px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }

        /* MODALS (GI·ªÆ NGUY√äN) */
        #edit-modal, #archive-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); z-index: 2000; align-items: center; justify-content: center; }
        .modal-content { background-color: var(--bg-box); padding: 20px; border-radius: 10px; width: 95%; max-width: 1100px; display: flex; flex-direction: column; height: 90vh; }
        .modal-body { display: flex; flex: 1; gap: 20px; overflow: hidden; position: relative; }
        #editor-container { flex: 3; display: flex; gap: 10px; overflow: hidden; }
        #history-panel { flex: 1; border-left: 1px solid #444; padding-left: 20px; display: flex; flex-direction: column; overflow: hidden; }
        .editor-col { flex: 1; display: flex; flex-direction: column; }
        textarea { background-color: #111; color: #eee; border: 1px solid #555; padding: 15px; flex: 1; font-family: monospace; resize: none; margin-bottom: 10px; font-size: 17px; line-height: 1.6; box-sizing: border-box; }
        
        /* DATA CENTER BUTTONS */
        .btn-data { background-color: #333; border: 1px solid #555; padding: 8px 15px; color: #eee; cursor: pointer; border-radius: 4px; margin-right: 5px; font-size: 0.8em; }
        .btn-sync { background-color: #2c3e50; border-color: #34495e; color: #a0c4ff; }
        .modal-actions { margin-top: 10px; display: flex; justify-content: space-between; }
        .btn-save { background-color: var(--check-bg); border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; color: #333;}
        .btn-close { background-color: var(--main-color); border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; color: #333;}

        #toast { visibility: hidden; min-width: 250px; background-color: var(--check-bg); color: #333; font-weight: bold; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 3000; left: 50%; bottom: 80px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        #restore-input { display: none; }
        #diff-view { flex: 1; background-color: #0d1117; border: 1px solid #444; padding: 15px; overflow-y: auto; font-family: monospace; font-size: 17px; line-height: 1.6; display: none; }
        .diff-line { padding: 2px 5px; border-bottom: 1px solid #222; white-space: pre-wrap; word-break: break-all; }
        .diff-added { background-color: var(--diff-add-bg); color: var(--diff-add-text); border-left: 3px solid var(--check-bg); }
        .diff-removed { background-color: var(--diff-rem-bg); color: var(--diff-rem-text); border-left: 3px solid var(--main-color); text-decoration: line-through; opacity: 0.7; }
        .diff-same { color: #666; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadein { from {bottom: 60px; opacity: 0;} to {bottom: 80px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 80px; opacity: 1;} to {bottom: 60px; opacity: 0;} }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
    </style>
</head>
<body>

    <div class="header-section">
        <div class="quote-card" id="daily-quote-card">
            <div class="quote-overlay"></div>
            <div class="quote-content">
                <div class="quote-text" id="quote-text"></div>
                <span class="quote-author" id="quote-author"></span>
            </div>
        </div>
        <div class="stats-container">
            <div class="stats-header">üìä NƒÇNG L∆Ø·ª¢NG & TI·∫æN ƒê·ªò</div>
            <div id="stats-content"></div>
        </div>
    </div>

    <div class="lam-reminder-bar" id="lam-bar">
        <span class="lam-icon">üë©‚Äçüíº</span>
        <span class="lam-label">Lam nh·∫Øn cho Meo:</span>
        <span class="lam-text" id="lam-msg">"..."</span>
    </div>

    <div id="dashboard-container"></div>

    <div id="braindom-box" class="studio-box">
        <div class="studio-header">üß† BRAINDOM STUDIO</div>
        <div class="studio-controls">
            <select id="braindom-action" class="studio-select">
                <option value="template">‚ûï Ch√®n M·∫´u (Vi·ªác/G·∫•p/Time)</option>
                <option value="copy">üìã Copy n·ªôi dung</option>
                <option value="clear">üóëÔ∏è X√≥a h·∫øt nh√°p</option>
            </select>
            <button class="studio-btn" onclick="executeBraindomAction()">TH·ª∞C HI·ªÜN</button>
        </div>
        <textarea id="brain-dump-area" class="studio-textarea" placeholder="ƒê·∫ßu √≥c ƒëang r·ªëi? N√©m h·∫øt v√†o ƒë√¢y... (T·ª± ƒë·ªông l∆∞u)"></textarea>
    </div>

    <div id="writer-box" class="studio-box">
        <div class="studio-header">üìñ WRITER'S STUDIO (G√ìC √ù T∆Ø·ªûNG VI·∫æT S√ÅCH)</div>
        <div class="studio-controls">
            <select id="writer-action" class="studio-select">
                <option value="idea">üíé Ch√®n: √ù t∆∞·ªüng th√¥</option>
                <option value="char">üë§ Ch√®n: H·ªì s∆° Nh√¢n v·∫≠t</option>
                <option value="chapter">üé¨ Ch√®n: C·∫•u tr√∫c Ch∆∞∆°ng</option>
                <option value="merge">üì• G·ªòP V√ÄO B·∫¢N TH·∫¢O CHUNG</option>
                <option value="view">üëÅÔ∏è XEM/S·ª¨A B·∫¢N TH·∫¢O</option>
                <option value="export">üíæ Xu·∫•t File .TXT</option>
            </select>
            <button class="studio-btn" onclick="executeWriterAction()">TH·ª∞C HI·ªÜN</button>
        </div>
        <textarea id="book-ideas-area" class="studio-textarea" placeholder="N∆°i nh·ªØng ki·ªát t√°c b·∫Øt ƒë·∫ßu..."></textarea>
    </div>

    <div id="toast">üéâ Xong th√™m 1 vi·ªác!</div>
    
    <div class="bottom-nav">
        <button class="nav-item" onclick="toggleTheme()">
            <span>üé®</span>
            <span class="nav-label">Theme</span>
        </button>
        <button class="nav-item" onclick="syncUp()">
            <span>‚òÅÔ∏è</span>
            <span class="nav-label">Upload</span>
        </button>
        <button class="nav-item" onclick="syncDown()">
            <span>üå®Ô∏è</span>
            <span class="nav-label">Download</span>
        </button>
        <button class="nav-item" onclick="openModal()">
            <span>‚öôÔ∏è</span>
            <span class="nav-label">Setting</span>
        </button>
    </div>

    <div class="scroll-widget">
        <button class="scroll-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚¨Ü</button>
        <button class="scroll-btn" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})">‚¨á</button>
    </div>

    <input type="file" id="restore-input" accept=".json" onchange="restoreData(this)">

    <div id="edit-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0; display:flex; justify-content:space-between;">
                <span>üìù C·∫¨P NH·∫¨T & SO S√ÅNH</span>
                <span style="font-size:0.6em; color:#666; font-weight:normal">D√πng Ctrl+Z n·∫øu l·ª° tay x√≥a nh·∫ßm</span>
            </h3>
            <div class="modal-body">
                <div id="editor-container">
                    <div class="editor-col" id="col-old" style="display:none">
                        <span class="editor-label">üìÅ D·ªÆ LI·ªÜU C≈® (G·ªêC)</span>
                        <textarea id="old-data" readonly style="opacity:0.7; border-style:dashed;"></textarea>
                    </div>
                    <div class="editor-col" id="col-new">
                        <span class="editor-label">‚úèÔ∏è D·ªÆ LI·ªÜU M·ªöI</span>
                        <textarea id="input-data" placeholder="Paste danh s√°ch Markdown m·ªõi v√†o ƒë√¢y..."></textarea>
                        <div id="diff-view"></div>
                    </div>
                </div>
                <div id="history-panel">
                    <span class="editor-label" style="color:var(--pastel-peach)">üïí TIME MACHINE</span>
                    <div id="history-list" class="history-list"></div>
                </div>
            </div>
            <div style="background:#111; padding:10px; border-radius:6px; border:1px solid #333; display:flex; align-items:center; flex-wrap:wrap; gap:5px; margin-top:10px; margin-bottom:10px;">
                <span class="data-center-label">üíæ LOCAL:</span>
                <button class="btn-data" onclick="backupFull(true)">üì§ BACKUP</button>
                <button class="btn-data" onclick="document.getElementById('restore-input').click()">üì• RESTORE</button>
                <button class="btn-data" onclick="exportCSV()" style="margin-left:auto; border-color:var(--pastel-green)">üìä EXPORT CSV</button>
            </div>
            <div class="modal-actions">
                <div class="left-actions"><button class="btn-compare" onclick="toggleCompare()" id="btn-compare">üîç SO S√ÅNH (T·∫ÆT)</button></div>
                <div class="right-actions"><button class="btn-close" onclick="closeModal()">ƒê√≥ng</button><button class="btn-save" onclick="saveData()">L∆ØU THAY ƒê·ªîI</button></div>
            </div>
        </div>
    </div>

    <div id="archive-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0;">üìö B·∫¢N TH·∫¢O CHUNG (MASTER DRAFT)</h3>
            <textarea id="archive-textarea" style="flex:1; background:#1a1a1a; color:#eee; border:1px solid #555; padding:15px; font-family:'Consolas', monospace; resize:none; font-size:16px; box-sizing: border-box;"></textarea>
            <div class="modal-actions">
                <button class="btn-close" onclick="document.getElementById('archive-modal').style.display='none'">ƒê√≥ng</button>
                <button class="btn-data" onclick="exportMasterDraft()" style="border-color:var(--check-bg); color:var(--check-bg)">üíæ XU·∫§T .TXT</button>
                <button class="btn-save" onclick="saveArchive()">L∆ØU L·∫†I</button>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const AIRTABLE = {
            PAT: 'patE1cRnlN0yvjW1y' + '.' + 'c084f80cf32df8ee63f63f22477ca64fb60ef67cfd61917776460ae282722b36',
            BASE_ID: 'app9cWP64Qbz0T1QT',
            TABLE_ID: 'tbluPfLWGE5oHVOqX',
            API_URL: `https://api.airtable.com/v0/app9cWP64Qbz0T1QT/tbluPfLWGE5oHVOqX`
        };
        const quotesDB = [{t:"Ch√∫ng ta ƒëau kh·ªï trong t∆∞·ªüng t∆∞·ª£ng nhi·ªÅu h∆°n l√† trong th·ª±c t·∫ø.",a:"Seneca"},{t:"K·ª∑ lu·∫≠t l√† l√†m nh·ªØng ƒëi·ªÅu b·∫°n gh√©t nh∆∞ th·ªÉ b·∫°n y√™u th√≠ch n√≥.",a:"Mike Tyson"},{t:"C√°ch t·ªët nh·∫•t ƒë·ªÉ d·ª± ƒëo√°n t∆∞∆°ng lai l√† t·∫°o ra n√≥.",a:"Peter Drucker"},{t:"T·∫≠p trung l√† ngh·ªá thu·∫≠t bi·∫øt n√≥i KH√îNG.",a:"Steve Jobs"},{t:"Kh√¥ng c√≥ √°p l·ª±c, kh√¥ng c√≥ kim c∆∞∆°ng.",a:"Thomas Carlyle"}];

        function initDailyQuote() {
            const today = new Date(); const start = new Date(today.getFullYear(),0,0); const diff = today-start; const oneDay = 1000*60*60*24;
            const dayOfYear = Math.floor(diff/oneDay); const quote = quotesDB[dayOfYear%quotesDB.length];
            document.getElementById('quote-text').innerHTML = `<span style="display:block; font-size:0.9em; margin-bottom:8px; color:var(--main-color);">Anh Meo √†,</span> "${quote.t}"`;
            document.getElementById('quote-author').textContent = `‚Äî ${quote.a}`;
            const myImages = ['5.jpg','6.jpg']; const randomImg = myImages[Math.floor(Math.random()*myImages.length)];
            document.getElementById('daily-quote-card').style.backgroundImage = `url('images/${randomImg}')`;
        }

        function renderDashboard(text) {
            const container = document.getElementById('dashboard-container'); container.innerHTML = '';
            const lines = text.split('\n'); let currentBox, currentList; let currentTaskItem = null;

            lines.forEach(line => {
                let trimmedLine = line.trim(); if (!trimmedLine) return;
                if (trimmedLine.startsWith('!!!')) { document.getElementById('lam-msg').textContent = trimmedLine.replace('!!!','').trim(); return; }
                
                // Note m·ªü r·ªông
                if (trimmedLine.startsWith('^')) {
                    if (currentTaskItem) {
                        let content = trimmedLine.substring(1).trim();
                        if (content.match(/https?:\/\//)) content = content.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
                        let noteBox = currentTaskItem.querySelector('.task-note-box');
                        if (!noteBox) {
                            currentTaskItem.insertAdjacentHTML('beforeend', `<div class="task-note-box"></div>`);
                            noteBox = currentTaskItem.querySelector('.task-note-box');
                            currentTaskItem.querySelector('.btn-note-toggle').classList.add('has-content');
                        }
                        noteBox.innerHTML += `<span class="note-line">${content}</span>`;
                    }
                    return;
                }

                // BOX HEADER
                if (trimmedLine.startsWith('#')) {
                    currentTaskItem = null;
                    const title = trimmedLine.replace('#','').trim();
                    const h2 = document.createElement('h2'); h2.textContent = title; container.appendChild(h2);
                    currentBox = document.createElement('div'); currentBox.className = 'box';
                    currentBox.setAttribute('data-type', title.toUpperCase()); 
                    
                    // Th√™m thanh Log Time ngay d∆∞·ªõi Header Box
                    const loggerHTML = `
                        <div class="time-logger-bar">
                            <input type="text" class="logger-input-code" placeholder="CODE" id="log-code-${title.replace(/\s/g,'')}">
                            <input type="number" class="logger-input-time" placeholder="Min" id="log-time-${title.replace(/\s/g,'')}">
                            <button class="logger-btn" onclick="quickLog('${title.replace(/\s/g,'')}')">LOG TIME</button>
                        </div>
                    `;
                    currentBox.innerHTML = loggerHTML;
                    
                    container.appendChild(currentBox);
                    currentList = document.createElement('ul'); currentList.className = 'task-list'; currentBox.appendChild(currentList);
                } 
                // TASK ITEM
                else if (trimmedLine.startsWith('-')) {
                    if (currentList) {
                        let level = 1; if (trimmedLine.startsWith('---')) level = 3; else if (trimmedLine.startsWith('--')) level = 2;
                        let parts = trimmedLine.replace(/^-+/, '').split('|');
                        let rawText = parts[0].trim();
                        let inlineNote = parts.length > 1 ? parts[1].trim() : "";
                        
                        // Parse ID
                        let displayHTML = rawText;
                        let taskIdRaw = stringToHash(rawText);
                        let idTagHTML = "";
                        const idMatch = rawText.match(/^\[([A-Za-z0-9-]+)\]/);
                        
                        if (idMatch) {
                            const fullTag = idMatch[0]; // [A-01]
                            const cleanCode = idMatch[1]; // A-01
                            const restOfText = rawText.substring(fullTag.length).trim();
                            // ID Tag click to autofill
                            idTagHTML = `<span class="task-id-tag" onclick="fillLogger(this, '${cleanCode}')">${fullTag}</span>`;
                            
                            // Note Button (Move here)
                            let noteBtnClass = inlineNote ? "has-content" : "";
                            let noteBtnHTML = `<button class="btn-note-toggle ${noteBtnClass}" onclick="toggleTaskNote(this)">üìù</button>`;
                            
                            displayHTML = `${idTagHTML}${noteBtnHTML} <span class="main-text">${restOfText}</span>`;
                        } else {
                            displayHTML = `<span class="main-text">${rawText}</span>`;
                        }

                        // Render Inline Note
                        let noteBoxHTML = "";
                        if (inlineNote) {
                            if (inlineNote.match(/^https?:\/\//)) inlineNote = `<a href="${inlineNote}" target="_blank">üîó ${inlineNote}</a>`;
                            noteBoxHTML = `<div class="task-note-box"><span class="note-line">${inlineNote}</span></div>`;
                        }

                        const taskId = 'task-' + taskIdRaw;
                        const totalTime = getTotalTime(taskId);
                        const timeBadge = totalTime > 0 ? `<span class="total-time-badge">(${totalTime}')</span>` : ``;

                        const li = document.createElement('li');
                        li.className = `task-item indent-${level}`;
                        li.setAttribute('data-id', taskId);
                        li.innerHTML = `
                            <span class="toggle-placeholder"></span>
                            <input type="checkbox" id="${taskId}" onclick="checkTask(this)">
                            <label for="${taskId}" class="task-label">${displayHTML} ${timeBadge}
                                <div class="mini-progress-container"><div class="mini-progress-fill"></div></div>
                            </label>
                            ${noteBoxHTML}
                        `;
                        currentList.appendChild(li);
                        currentTaskItem = li;
                        if(localStorage.getItem(taskId) === "true") li.querySelector('input').checked = true;
                    }
                }
            });
            initFolding(container); calculateStats(); 
        }

        // --- NEW LOGIC FOR V28 ---
        function fillLogger(span, code) {
            // T√¨m c√°i box ch·ª©a task n√†y
            const box = span.closest('.box');
            if(box) {
                const inputCode = box.querySelector('.logger-input-code');
                const inputTime = box.querySelector('.logger-input-time');
                if(inputCode) {
                    inputCode.value = code;
                    inputTime.focus();
                }
            }
        }

        function quickLog(boxId) {
            const inputCode = document.getElementById(`log-code-${boxId}`);
            const inputTime = document.getElementById(`log-time-${boxId}`);
            const code = inputCode.value.trim();
            const minutes = parseInt(inputTime.value);

            if (!code || isNaN(minutes) || minutes <= 0) { alert("Vui l√≤ng nh·∫≠p M√£ Task v√† S·ªë ph√∫t!"); return; }

            // T√¨m Task ID th·∫≠t d·ª±a tr√™n Text trong Data g·ªëc (Ph·ª©c t·∫°p nh∆∞ng ch√≠nh x√°c)
            // ƒê∆°n gi·∫£n h√≥a: Scan DOM t√¨m task c√≥ ch·ª©a m√£ n√†y
            const allTags = document.querySelectorAll('.task-id-tag');
            let foundTaskId = null;
            
            allTags.forEach(tag => {
                if (tag.innerText.includes(code)) {
                    foundTaskId = tag.closest('.task-item').getAttribute('data-id');
                }
            });

            if (foundTaskId) {
                logTime(foundTaskId, minutes);
                inputTime.value = '';
                // Reload nh·∫π ƒë·ªÉ hi·ªán s·ªë ph√∫t m·ªõi
                const data = localStorage.getItem('dashboardData') || defaultData;
                renderDashboard(data);
            } else {
                alert("‚ùå Kh√¥ng t√¨m th·∫•y Task c√≥ m√£: " + code);
            }
        }

        function toggleTaskNote(btn) {
            const item = btn.closest('.task-item');
            const noteBox = item.querySelector('.task-note-box');
            if (noteBox) {
                if (noteBox.classList.contains('show')) noteBox.classList.remove('show');
                else noteBox.classList.add('show');
            }
        }

        function executeBraindomAction() {
            const action = document.getElementById('braindom-action').value;
            if (action === 'template') insertBDTemplate();
            else if (action === 'copy') copyBrainDump();
            else if (action === 'clear') clearBrainDump();
        }

        function executeWriterAction() {
            const action = document.getElementById('writer-action').value;
            if (action === 'merge') mergeToMasterDraft();
            else if (action === 'view') openArchiveModal();
            else if (action === 'export') exportBookTxt();
            else insertBookTemplate(action);
        }

        // --- CORE FUNCTIONS (Preserved) ---
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'classic' ? '' : 'classic'); localStorage.setItem('theme', document.body.getAttribute('data-theme')); }
        function saveBrainDump() { localStorage.setItem('zetmeo_braindump', document.getElementById('brain-dump-area').value); }
        function loadBrainDump() { document.getElementById('brain-dump-area').value = localStorage.getItem('zetmeo_braindump') || ''; }
        function insertBDTemplate() { document.getElementById('brain-dump-area').value += `\n\n--- KHO NH√ÅP ---\n- [Vi·ªác] \n- [?] `; saveBrainDump(); }
        function copyBrainDump() { navigator.clipboard.writeText(document.getElementById('brain-dump-area').value); alert("ƒê√£ copy!"); }
        function clearBrainDump() { if(confirm('X√≥a?')) { document.getElementById('brain-dump-area').value = ""; saveBrainDump(); } }
        function saveBookIdeas() { localStorage.setItem('zetmeo_book_draft_current', document.getElementById('book-ideas-area').value); }
        function loadBookIdeas() { document.getElementById('book-ideas-area').value = localStorage.getItem('zetmeo_book_draft_current') || ''; }
        function insertBookTemplate(type) { document.getElementById('book-ideas-area').value += (type==='char' ? `\nüë§ Nh√¢n v·∫≠t:` : (type==='chapter' ? `\nüé¨ Ch∆∞∆°ng:` : `\nüíé √ù t∆∞·ªüng:`)); saveBookIdeas(); }
        function mergeToMasterDraft() { 
            const cur = document.getElementById('book-ideas-area').value.trim(); if(!cur) return;
            if(confirm("G·ªôp?")) { localStorage.setItem('zetmeo_book_master', (localStorage.getItem('zetmeo_book_master')||"") + "\n\n--- " + new Date().toLocaleString() + " ---\n" + cur); document.getElementById('book-ideas-area').value=""; saveBookIdeas(); alert("ƒê√£ g·ªôp!"); }
        }
        function openArchiveModal() { document.getElementById('archive-textarea').value = localStorage.getItem('zetmeo_book_master')||""; document.getElementById('archive-modal').style.display='flex'; }
        function saveArchive() { localStorage.setItem('zetmeo_book_master', document.getElementById('archive-textarea').value); document.getElementById('archive-modal').style.display='none'; }
        function exportMasterDraft() { /* Keep existing export logic */ }
        function checkTask(cb) { localStorage.setItem(cb.id, cb.checked); calculateStats(); }
        function calculateStats() { /* Keep existing stats logic */ }
        function initFolding(container) { /* Keep existing folding logic */ }
        function getLogs() { return JSON.parse(localStorage.getItem('zetmeo_time_logs') || '{}'); }
        function logTime(id, min) { let l=getLogs(); if(!l[id]) l[id]=[]; l[id].push({date:new Date().toISOString(), min:min}); localStorage.setItem('zetmeo_time_logs',JSON.stringify(l)); document.getElementById('toast').innerText=`ƒê√£ ghi ${min}p!`; document.getElementById('toast').className="show"; setTimeout(()=>document.getElementById('toast').className="",3000); }
        function getTotalTime(id) { let l=getLogs(); return l[id] ? l[id].reduce((a,b)=>a+b.min,0) : 0; }
        function stringToHash(s) { let h=0; for(let i=0;i<s.length;i++) h=Math.abs(((h<<5)-h)+s.charCodeAt(i)); return h; }
        
        // --- CLOUD SYNC & OTHERS (Gi·ªØ nguy√™n logic c≈©) ---
        async function getRecordID() {
            let recordId = localStorage.getItem('zetmeo_cloud_record_id');
            if (recordId) return recordId;
            try {
                const response = await fetch(AIRTABLE.API_URL, {
                    headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}` }
                });
                const data = await response.json();
                if (data.records && data.records.length > 0) {
                    recordId = data.records[0].id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                } else {
                    const createResponse = await fetch(AIRTABLE.API_URL, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}`, 'Content-Type': 'application/json' },
                        body: JSON.stringify({ fields: { "Data": "{}" } })
                    });
                    const createData = await createResponse.json();
                    recordId = createData.id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                }
            } catch (error) { return null; }
        }
        async function syncUp() { 
            if(!confirm("Upload?")) return; 
            const rid = await getRecordID(); if(!rid) return;
            fetch(`${AIRTABLE.API_URL}/${rid}`, {method:'PATCH', headers:{'Authorization':`Bearer ${AIRTABLE.PAT}`,'Content-Type':'application/json'}, body:JSON.stringify({fields:{"Data":JSON.stringify(localStorage)}})}).then(r=>r.ok?alert("‚úÖ OK"):alert("L·ªói"));
        }
        async function syncDown() {
            if(!confirm("Download?")) return;
            const rid = await getRecordID(); if(!rid) return;
            fetch(`${AIRTABLE.API_URL}/${rid}`, {headers:{'Authorization':`Bearer ${AIRTABLE.PAT}`}}).then(r=>r.json()).then(d=>{
                if(d.fields.Data) { const l=JSON.parse(d.fields.Data); localStorage.clear(); Object.keys(l).forEach(k=>localStorage.setItem(k,l[k])); location.reload(); }
            });
        }
        function openModal(){ document.getElementById('input-data').value=localStorage.getItem('dashboardData')||defaultData; document.getElementById('edit-modal').style.display='flex'; }
        function closeModal(){ document.getElementById('edit-modal').style.display='none'; }
        function saveData(){ localStorage.setItem('dashboardData', document.getElementById('input-data').value); renderDashboard(document.getElementById('input-data').value); closeModal(); }

        window.onload = function() { 
            const data = localStorage.getItem('dashboardData') || defaultData; 
            renderDashboard(data);
            initDailyQuote(); 
            if (localStorage.getItem('theme') === 'classic') document.body.setAttribute('data-theme', 'classic');
            initAutoBackupScheduler();
            loadBrainDump(); 
            loadBookIdeas(); 
            document.getElementById('brain-dump-area').addEventListener('input', saveBrainDump);
            document.getElementById('book-ideas-area').addEventListener('input', saveBookIdeas); 
        }
    </script>
</body>
</html>
