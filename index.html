<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>zetmeoOS - Dashboard 26.0 (Cloud Sync)</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="zetmeoOS">
    <link rel="apple-touch-icon" href="https://img.icons8.com/color/96/check-all--v1.png">
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/check-all--v1.png">

    <style>
        :root {
            /* --- C·∫§U H√åNH CHUNG --- */
            --bg-body: #232323; --bg-box: #2d2d2d;
            --text-main: #fcfcfc; --text-dim: #b0b0b0;
            --transition-speed: 0.3s;

            /* --- THEME 1: PASTEL --- */
            --main-color: #FF90BC; --sub-1: #FFC0D9; --sub-2: #F9F9E0; --sub-3: #8ACDD7;
            --check-bg: #ABE7B2; --check-tick: #444;
            --tag-urgent: #FF90BC; --tag-core: #8ACDD7; --tag-found: #FFC0D9;
            --btn-note-hover: rgba(249, 249, 224, 0.1);
            
            --diff-add-bg: rgba(46, 160, 67, 0.15); --diff-add-text: #7ee787;
            --diff-rem-bg: rgba(248, 81, 73, 0.15); --diff-rem-text: #ff7b72;
            --book-border: #FFC0D9; --book-bg: rgba(255, 192, 217, 0.05);
        }

        /* --- THEME 2: CLASSIC --- */
        [data-theme="classic"] {
            --main-color: #ffadad; --sub-1: #e0bbe4; --sub-2: #ffdac1; --sub-3: #a0c4ff;
            --check-bg: #4cd137; --check-tick: #fff;
            --tag-urgent: #ff6b6b; --tag-core: #48dbfb; --tag-found: #feca57;
            --btn-note-hover: rgba(255, 255, 255, 0.1);
            --book-border: #a0c4ff; --book-bg: rgba(160, 196, 255, 0.05);
        }

        /* MAPPING */
        :root {
            --pastel-pink: var(--main-color); --pastel-red: var(--main-color);
            --pastel-green: var(--check-bg); --pastel-peach: var(--sub-2);
            --pastel-lavender: var(--sub-1); --pastel-blue: var(--sub-3);
            --check-green: var(--check-bg); --btn-fire: var(--main-color);
            --btn-focus: var(--sub-3); --note-bg: #353b48;
        }

        body {
            background-color: var(--bg-body); color: var(--text-main);
            font-family: 'Consolas', 'Segoe UI', sans-serif;
            padding: 20px; max-width: 900px; margin: 0 auto; line-height: 1.6;
            padding-bottom: 120px; transition: all var(--transition-speed);
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER & QUOTE --- */
        .header-section { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; margin-bottom: 25px; min-height: 220px; }
        @media (max-width: 700px) { .header-section { grid-template-columns: 1fr; } }

        .quote-card {
            background-color: #222; border-radius: 12px; border: 2px solid var(--pastel-red);
            position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            display: flex; flex-direction: column; justify-content: flex-end; padding: 25px;
            background-size: cover; background-position: center; transition: border-color var(--transition-speed);
        }
        .quote-card:hover { transform: scale(1.02); }
        .quote-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(0,0,0,0.95), rgba(0,0,0,0.3)); z-index: 1; }
        .quote-content { position: relative; z-index: 2; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.8); }
        .quote-text { font-size: 1.2em; font-weight: bold; font-style: italic; line-height: 1.4; margin-bottom: 15px; font-family: 'Georgia', serif; }
        .quote-author { font-size: 0.85em; color: var(--pastel-peach); text-align: right; display: block; }

        .stats-container { background-color: #1a1e24; border: 1px solid #444; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; flex-direction: column; justify-content: center; }
        .stats-header { color: var(--pastel-blue); font-weight: bold; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 5px; font-size: 0.9em; }
        .stat-row { margin-bottom: 12px; }
        .stat-label { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; }
        .stat-bar-bg { background-color: #333; height: 8px; border-radius: 4px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease, background-color var(--transition-speed); }
        .bar-urgent { background-color: var(--pastel-red); } .bar-core { background-color: var(--pastel-green); } .bar-foundation { background-color: var(--pastel-peach); } .bar-total { background: linear-gradient(90deg, var(--pastel-pink), var(--pastel-blue)); }

        .lam-reminder-bar {
            background-color: var(--pastel-pink); color: #4a2c2a; padding: 15px 25px;
            border-radius: 12px; border: 2px solid rgba(255,255,255,0.3); font-weight: bold;
            display: flex; align-items: center; flex-wrap: wrap; margin-bottom: 40px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 1.05em; animation: fadeIn 1s ease-in;
            transition: background-color var(--transition-speed);
        }
        .lam-icon { margin-right: 10px; font-size: 1.5em; animation: bounce 2s infinite; }
        .lam-label { margin-right: 10px; text-transform: uppercase; font-size: 0.75em; letter-spacing: 1px; background: rgba(255,255,255,0.3); padding: 4px 8px; border-radius: 6px; }

        h2 { color: var(--pastel-lavender); margin-top: 40px; border-bottom: 1px dashed #555; padding-bottom: 10px; }
        .box { border: 1px solid #444; background-color: var(--bg-box); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .box[data-type*="URGENT"] { border-left: 6px solid var(--pastel-red); } .box[data-type*="CORE"] { border-left: 6px solid var(--pastel-blue); } .box[data-type*="FOUNDATION"] { border-left: 6px solid var(--pastel-peach); } .box[data-type*="KHO"] { border-left: 6px solid #666; opacity: 0.7; }
        .note { font-size: 0.9em; color: var(--text-dim); margin-bottom: 15px; font-style: italic; display: block; }
        
        .task-list { list-style: none; padding: 0; }
        .task-item { margin-bottom: 5px; display: flex; align-items: center; flex-wrap: wrap; padding: 8px; border-radius: 6px; border-bottom: 1px solid #3d3d3d; transition: all 0.2s; }
        .task-item:hover { background-color: #383838; }
        .hidden-task { display: none !important; }
        
        .indent-1 { margin-left: 0px; border-left: 3px solid transparent; } .indent-2 { margin-left: 25px; border-left: 3px solid #555; background-color: rgba(255,255,255,0.02); } .indent-3 { margin-left: 50px; border-left: 3px solid #777; background-color: rgba(255,255,255,0.04); }
        .toggle-btn { cursor: pointer; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 5px; color: var(--pastel-blue); font-size: 12px; user-select: none; transition: transform 0.2s; } .rotated { transform: rotate(90deg); } .spacer { width: 25px; }
        
        .task-item input[type="checkbox"] { appearance: none; -webkit-appearance: none; width: 20px; height: 20px; border: 2px solid var(--text-dim); border-radius: 50%; margin-right: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .task-item input:checked { background-color: var(--check-green); border-color: var(--check-green); }
        .task-item input:checked::after { content: '‚úî'; color: var(--check-tick); font-size: 14px; font-weight: bold; }
        
        .task-label { flex: 1; margin-right: 10px; cursor: pointer; position: relative; } 
        .task-id-tag { font-family: 'Consolas', monospace; font-size: 0.85em; font-weight: bold; padding: 2px 6px; border-radius: 4px; margin-right: 8px; color: #111; display: inline-block; transition: background-color var(--transition-speed); }
        .tag-A { background-color: var(--tag-urgent); } .tag-B { background-color: var(--tag-core); } .tag-C { background-color: var(--tag-found); } .tag-D { background-color: #bdc3c7; }
        .task-item input:checked + .task-label { text-decoration: line-through; color: #666; }
        .task-item input:checked + .task-label .task-id-tag { opacity: 0.5; filter: grayscale(100%); }
        
        /* MINI PROGRESS */
        .mini-progress-container { display: inline-block; width: 60px; height: 6px; background-color: #444; border-radius: 3px; margin-left: 10px; vertical-align: middle; display: none; position: relative; }
        .mini-progress-fill { height: 100%; background-color: var(--pastel-pink); border-radius: 3px; width: 0%; transition: width 0.3s; }
        .mini-progress-text { font-size: 0.7em; color: var(--pastel-pink); margin-left: 5px; display: none; }
        .has-children .mini-progress-container, .has-children .mini-progress-text { display: inline-block; }

        /* TIME TRACKER */
        .task-actions { display: flex; gap: 5px; margin-left: auto; align-items: center; }
        .time-tracker-box { display: flex; align-items: center; margin-right: 5px; background: #222; border-radius: 4px; border: 1px solid #444; padding: 2px 5px; }
        .time-input { width: 40px; background: transparent; border: none; color: var(--pastel-peach); font-family: 'Consolas'; font-size: 0.9em; text-align: center; }
        .time-input::placeholder { color: #555; }
        .time-input:focus { outline: none; border-bottom: 1px solid var(--pastel-peach); }
        .total-time-badge { font-size: 0.75em; color: var(--pastel-green); background: rgba(171, 231, 178, 0.1); padding: 1px 5px; border-radius: 3px; margin-left: 5px; font-weight: bold; }

        .btn-timer { border: none; padding: 4px 10px; border-radius: 4px; font-weight: bold; cursor: pointer; color: #333; min-width: 40px; font-size: 0.8em; transition: background-color var(--transition-speed); }
        .btn-1m { background-color: var(--btn-fire); } .btn-15m { background-color: var(--btn-focus); }
        .timer-running { background-color: #fff !important; color: #d63031 !important; animation: pulse 1s infinite; }
        
        .btn-note-toggle { border: 1px solid #555; background: transparent; padding: 4px 8px; border-radius: 4px; cursor: pointer; color: #777; font-size: 0.9em; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .btn-note-toggle.has-content { color: var(--pastel-peach); border-color: var(--pastel-peach); font-weight: bold; }
        .btn-note-toggle.has-content:hover { background-color: var(--btn-note-hover); }
        
        .task-note-box { display: none; width: 100%; margin-top: 10px; margin-left: 35px; background-color: var(--note-bg); padding: 10px 15px; border-radius: 6px; border-left: 3px solid var(--pastel-peach); font-size: 0.9em; color: #dcdde1; line-height: 1.6; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); white-space: pre-wrap; }
        .task-note-box.show { display: block; animation: slideDown 0.2s ease-out; }
        .task-note-box a { color: var(--pastel-blue); text-decoration: none; border-bottom: 1px dotted; }
        .task-note-box a:hover { color: #fff; }
        .note-line { display: block; margin-bottom: 4px; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,255,255,0.7); } 70% { box-shadow: 0 0 0 5px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

        /* BRAIN DUMP STYLES */
        .brain-dump-box {
            margin-top: 40px; margin-bottom: 20px; 
            border: 2px dashed var(--text-dim); border-radius: 12px;
            padding: 20px; background-color: rgba(0,0,0,0.2);
        }
        .brain-dump-header { font-weight: bold; color: var(--pastel-peach); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .brain-dump-controls { display: flex; gap: 10px; margin-bottom: 10px; }
        .btn-bd { 
            background: #333; border: 1px solid #555; color: #ccc; 
            padding: 5px 10px; font-size: 0.8em; border-radius: 4px; cursor: pointer; 
        }
        .btn-bd:hover { border-color: var(--pastel-blue); color: var(--pastel-blue); }
        .brain-dump-textarea {
            width: 100%; min-height: 150px; background: transparent; 
            border: 1px solid #444; color: #ddd; font-family: 'Consolas', monospace; 
            padding: 10px; border-radius: 6px; resize: vertical; line-height: 1.5; font-size: 0.95em;
            box-sizing: border-box; 
        }
        .brain-dump-textarea:focus { outline: none; border-color: var(--pastel-blue); }

        /* BOOK IDEAS STYLES */
        .book-ideas-box {
            margin-bottom: 80px; 
            border: 2px solid var(--book-border); border-radius: 12px;
            padding: 20px; background-color: var(--book-bg);
            transition: all 0.3s;
        }
        .book-header { font-weight: bold; color: var(--book-border); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; }
        .book-controls { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; align-items: center; }
        .btn-book { 
            background: rgba(0,0,0,0.3); border: 1px solid var(--book-border); color: var(--book-border);
            padding: 5px 15px; font-size: 0.85em; border-radius: 4px; cursor: pointer; font-weight: bold;
        }
        .btn-book:hover { background-color: var(--book-border); color: #333; }
        .btn-book-merge { background-color: var(--pastel-peach); color: #333; border: none; font-weight: bold; margin-left: auto; }
        
        .book-textarea {
            width: 100%; min-height: 150px; background: rgba(0,0,0,0.2); 
            border: 1px solid var(--book-border); color: #eee; font-family: 'Consolas', 'Segoe UI', sans-serif; 
            padding: 15px; border-radius: 6px; resize: vertical; line-height: 1.6; font-size: 1.0em;
            margin-bottom: 10px;
            box-sizing: border-box; 
        }
        .book-textarea:focus { outline: none; box-shadow: 0 0 10px rgba(255, 192, 217, 0.2); }

        /* UI BUTTONS */
        #btn-edit { position: fixed; bottom: 20px; right: 20px; background-color: var(--pastel-blue); color: #333; padding: 15px 25px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 100; transition: background-color var(--transition-speed); }
        #btn-theme { position: fixed; bottom: 20px; left: 20px; background-color: var(--bg-box); color: var(--pastel-pink); border: 2px solid var(--pastel-pink); padding: 15px 25px; border-radius: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 100; transition: all 0.3s; }
        #btn-theme:hover { background-color: var(--pastel-pink); color: #333; }

        /* MODAL */
        #edit-modal, #archive-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background-color: var(--bg-box); padding: 20px; border-radius: 10px; width: 95%; max-width: 1100px; display: flex; flex-direction: column; height: 90vh; }
        .modal-body { display: flex; flex: 1; gap: 20px; overflow: hidden; position: relative; }
        #editor-container { flex: 3; display: flex; gap: 10px; overflow: hidden; }
        #history-panel { flex: 1; border-left: 1px solid #444; padding-left: 20px; display: flex; flex-direction: column; overflow: hidden; }
        .editor-col { flex: 1; display: flex; flex-direction: column; }
        .editor-label { font-weight: bold; color: var(--pastel-peach); margin-bottom: 5px; display: block;}
        textarea { background-color: #111; color: #eee; border: 1px solid #555; padding: 15px; flex: 1; font-family: monospace; resize: none; margin-bottom: 10px; font-size: 17px; line-height: 1.6; box-sizing: border-box; }
        textarea:focus { outline: 1px solid var(--pastel-blue); }
        #diff-view { flex: 1; background-color: #0d1117; border: 1px solid #444; padding: 15px; overflow-y: auto; font-family: monospace; font-size: 17px; line-height: 1.6; display: none; }
        .diff-line { padding: 2px 5px; border-bottom: 1px solid #222; white-space: pre-wrap; word-break: break-all; }
        .diff-added { background-color: var(--diff-add-bg); color: var(--diff-add-text); border-left: 3px solid var(--check-green); }
        .diff-removed { background-color: var(--diff-rem-bg); color: var(--diff-rem-text); border-left: 3px solid var(--pastel-red); text-decoration: line-through; opacity: 0.7; }
        .diff-same { color: #666; }
        .history-list { overflow-y: auto; flex: 1; }
        .history-item { background: #222; padding: 10px; margin-bottom: 10px; border-radius: 6px; cursor: pointer; border: 1px solid #333; }
        .history-item:hover { background: #333; border-color: var(--pastel-blue); }
        .history-time { font-size: 0.8em; color: var(--pastel-blue); font-weight: bold; display: block;}
        .history-preview { font-size: 0.7em; color: #777; display: block; margin-top: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .modal-actions { margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }
        .right-actions { display: flex; gap: 10px; }
        .btn-save { background-color: var(--pastel-green); border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; color: #333;}
        .btn-close { background-color: var(--pastel-red); border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; color: #333;}
        .btn-compare { background-color: var(--pastel-blue); border: none; padding: 10px 25px; cursor: pointer; font-weight: bold; border-radius: 5px; color: #333; }
        
        .btn-data { background-color: #333; border: 1px solid #555; padding: 8px 15px; color: #eee; cursor: pointer; border-radius: 4px; margin-right: 5px; font-size: 0.8em; transition: all 0.2s;}
        .btn-data:hover { background-color: #444; border-color: var(--pastel-blue); }
        .btn-sync { background-color: #2c3e50; border: 1px solid #34495e; color: #a0c4ff; }
        .btn-sync:hover { background-color: #34495e; border-color: #a0c4ff; }
        
        .data-center-label { font-size: 0.8em; color: #888; margin-right: 10px; text-transform: uppercase; font-weight: bold; letter-spacing: 1px;}

        #toast { visibility: hidden; min-width: 250px; background-color: var(--check-green); color: #333; font-weight: bold; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 999; left: 50%; bottom: 80px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        #restore-input { display: none; }
    </style>
</head>
<body>

    <div class="header-section">
        <div class="quote-card" id="daily-quote-card">
            <div class="quote-overlay"></div>
            <div class="quote-content">
                <div class="quote-text" id="quote-text"></div>
                <span class="quote-author" id="quote-author"></span>
            </div>
        </div>
        <div class="stats-container">
            <div class="stats-header">üìä NƒÇNG L∆Ø·ª¢NG & TI·∫æN ƒê·ªò</div>
            <div id="stats-content"></div>
        </div>
    </div>

    <div class="lam-reminder-bar" id="lam-bar">
        <span class="lam-icon">üë©‚Äçüíº</span>
        <span class="lam-label">Lam nh·∫Øn cho Meo:</span>
        <span class="lam-text" id="lam-msg">"..."</span>
    </div>

    <div id="dashboard-container"></div>

    <div class="brain-dump-box">
        <div class="brain-dump-header">üß† BRAINDOM STUDIO</div>
        <div class="brain-dump-controls">
            <button class="btn-bd" onclick="insertBDTemplate()">‚ûï Ch√®n M·∫´u</button>
            <button class="btn-bd" onclick="copyBrainDump()">üìã Copy g·ª≠i Lam</button>
            <button class="btn-bd" onclick="clearBrainDump()" style="margin-left:auto; border-color:var(--pastel-red); color:var(--pastel-red)">üóëÔ∏è X√≥a Nh√°p</button>
        </div>
        <textarea id="brain-dump-area" class="brain-dump-textarea" placeholder="ƒê·∫ßu √≥c ƒëang r·ªëi? N√©m h·∫øt v√†o ƒë√¢y r·ªìi copy g·ª≠i cho Lam x·ª≠ l√Ω nh√©..."></textarea>
    </div>

    <div class="book-ideas-box">
        <div class="book-header">üìñ WRITER'S STUDIO (G√ìC √ù T∆Ø·ªûNG VI·∫æT S√ÅCH)</div>
        <div class="book-controls">
            <button class="btn-book" onclick="insertBookTemplate('idea')">üíé √ù t∆∞·ªüng th√¥</button>
            <button class="btn-book" onclick="insertBookTemplate('char')">üë§ Nh√¢n v·∫≠t</button>
            <button class="btn-book" onclick="insertBookTemplate('chapter')">üé¨ Ch∆∞∆°ng</button>
            
            <button class="btn-book btn-book-merge" onclick="mergeToMasterDraft()">üì• G·ªòP V√ÄO B·∫¢N TH·∫¢O CHUNG</button>
            <button class="btn-book" onclick="openArchiveModal()">üëÅÔ∏è XEM/S·ª¨A B·∫¢N TH·∫¢O</button>
        </div>
        <textarea id="book-ideas-area" class="book-textarea" placeholder="Vi·∫øt √Ω t∆∞·ªüng h√¥m nay v√†o ƒë√¢y... (B·∫•m 'G·ªôp' ƒë·ªÉ l∆∞u v√†o kho, ƒë·ª´ng ƒë·ªÉ ƒë√¢y l√¢u qu√° nh√©)"></textarea>
    </div>

    <div id="toast">üéâ Xong th√™m 1 vi·ªác!</div>
    
    <button id="btn-theme" onclick="toggleTheme()">üé® ƒê·ªîI GIAO DI·ªÜN</button>
    <button id="btn-edit" onclick="openModal()">‚öôÔ∏è C·∫¨P NH·∫¨T</button>
    <input type="file" id="restore-input" accept=".json" onchange="restoreData(this)">

    <div id="edit-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0; display:flex; justify-content:space-between;">
                <span>üìù C·∫¨P NH·∫¨T & SO S√ÅNH</span>
                <span style="font-size:0.6em; color:#666; font-weight:normal">D√πng Ctrl+Z n·∫øu l·ª° tay x√≥a nh·∫ßm</span>
            </h3>
            <div class="modal-body">
                <div id="editor-container">
                    <div class="editor-col" id="col-old" style="display:none">
                        <span class="editor-label">üìÅ D·ªÆ LI·ªÜU C≈® (G·ªêC)</span>
                        <textarea id="old-data" readonly style="opacity:0.7; border-style:dashed;"></textarea>
                    </div>
                    <div class="editor-col" id="col-new">
                        <span class="editor-label">‚úèÔ∏è D·ªÆ LI·ªÜU M·ªöI</span>
                        <textarea id="input-data" placeholder="Paste danh s√°ch Markdown m·ªõi v√†o ƒë√¢y..."></textarea>
                        <div id="diff-view"></div>
                    </div>
                </div>
                <div id="history-panel">
                    <span class="editor-label" style="color:var(--pastel-peach)">üïí TIME MACHINE</span>
                    <div id="history-list" class="history-list"></div>
                </div>
            </div>
            
            <div style="background:#111; padding:10px; border-radius:6px; border:1px solid #333; display:flex; align-items:center; flex-wrap:wrap; gap:5px; margin-top:10px; margin-bottom:10px;">
                <span class="data-center-label">‚òÅÔ∏è CLOUD SYNC:</span>
                <button class="btn-data btn-sync" onclick="syncUp()">‚òÅÔ∏è UPLOAD (L∆∞u l√™n M√¢y)</button>
                <button class="btn-data btn-sync" onclick="syncDown()">üå®Ô∏è DOWNLOAD (T·∫£i v·ªÅ m√°y)</button>
                <span style="border-left:1px solid #555; margin:0 5px; height:20px;"></span>
                <span class="data-center-label">üíæ LOCAL:</span>
                <button class="btn-data" onclick="backupFull(true)">üì§ BACKUP</button>
                <button class="btn-data" onclick="document.getElementById('restore-input').click()">üì• RESTORE</button>
                <button class="btn-data" onclick="exportCSV()" style="margin-left:auto; border-color:var(--pastel-green)">üìä EXPORT CSV</button>
            </div>

            <div class="modal-actions">
                <div class="left-actions">
                    <button class="btn-compare" onclick="toggleCompare()" id="btn-compare">üîç SO S√ÅNH (T·∫ÆT)</button>
                </div>
                <div class="right-actions">
                    <button class="btn-close" onclick="closeModal()">ƒê√≥ng</button>
                    <button class="btn-save" onclick="saveData()">L∆ØU THAY ƒê·ªîI</button>
                </div>
            </div>
        </div>
    </div>

    <div id="archive-modal">
        <div class="modal-content">
            <h3 style="color:var(--pastel-lavender); margin-top:0;">üìö B·∫¢N TH·∫¢O CHUNG (MASTER DRAFT)</h3>
            <p style="color:#888; font-size:0.9em; margin-top:-10px">ƒê√¢y l√† n∆°i l∆∞u tr·ªØ to√†n b·ªô √Ω t∆∞·ªüng ƒë√£ ƒë∆∞·ª£c g·ªôp. B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a tr·ª±c ti·∫øp t·∫°i ƒë√¢y.</p>
            <textarea id="archive-textarea" style="flex:1; background:#1a1a1a; color:#eee; border:1px solid #555; padding:15px; font-family:'Consolas', monospace; resize:none; font-size:16px; box-sizing: border-box;"></textarea>
            <div class="modal-actions">
                <button class="btn-close" onclick="document.getElementById('archive-modal').style.display='none'">ƒê√≥ng</button>
                <button class="btn-data" onclick="exportMasterDraft()" style="border-color:var(--check-green); color:var(--check-green)">üíæ XU·∫§T TO√ÄN B·ªò B·∫¢N TH·∫¢O (.txt)</button>
                <button class="btn-save" onclick="saveArchive()">L∆ØU L·∫†I</button>
            </div>
        </div>
    </div>

    <script>
        // --- AIRTABLE CONFIGURATION ---
     const AIRTABLE = {
    // M·∫πo: C·∫Øt ƒë√¥i chu·ªói token ƒë·ªÉ GitHub kh√¥ng ch·∫∑n
    PAT: 'patE1cRnlN0yvjW1y' + '.' + 'c084f80cf32df8ee63f63f22477ca64fb60ef67cfd61917776460ae282722b36',
    BASE_ID: 'app9cWP64Qbz0T1QT',
    TABLE_ID: 'tbluPfLWGE5oHVOqX',
    API_URL: `https://api.airtable.com/v0/app9cWP64Qbz0T1QT/tbluPfLWGE5oHVOqX`
};
        const quotesDB = [
            {t: "Ch√∫ng ta ƒëau kh·ªï trong t∆∞·ªüng t∆∞·ª£ng nhi·ªÅu h∆°n l√† trong th·ª±c t·∫ø.", a: "Seneca"},
            {t: "K·ª∑ lu·∫≠t l√† l√†m nh·ªØng ƒëi·ªÅu b·∫°n gh√©t nh∆∞ th·ªÉ b·∫°n y√™u th√≠ch n√≥.", a: "Mike Tyson"},
            {t: "C√°ch t·ªët nh·∫•t ƒë·ªÉ d·ª± ƒëo√°n t∆∞∆°ng lai l√† t·∫°o ra n√≥.", a: "Peter Drucker"},
            {t: "T·∫≠p trung l√† ngh·ªá thu·∫≠t bi·∫øt n√≥i KH√îNG.", a: "Steve Jobs"},
            {t: "Kh√¥ng c√≥ √°p l·ª±c, kh√¥ng c√≥ kim c∆∞∆°ng.", a: "Thomas Carlyle"},
            {t: "M·ª•c ti√™u kh√¥ng c√≥ k·∫ø ho·∫°ch ch·ªâ l√† m·ªôt ∆∞·ªõc m∆°.", a: "Antoine de Saint-Exup√©ry"},
            {t: "H√†nh tr√¨nh v·∫°n d·∫∑m b·∫Øt ƒë·∫ßu t·ª´ m·ªôt b∆∞·ªõc ch√¢n.", a: "L√£o T·ª≠"},
            {t: "Ng∆∞·ªùi duy nh·∫•t b·∫°n n√™n c·ªë g·∫Øng ƒë·ªÉ t·ªët h∆°n ch√≠nh l√† b·∫°n c·ªßa ng√†y h√¥m qua.", a: "Khuy·∫øt danh"},
            {t: "H·∫°nh ph√∫c kh√¥ng ph·∫£i l√† c√≥ t·∫•t c·∫£ nh·ªØng g√¨ b·∫°n mu·ªën, m√† l√† tr√¢n tr·ªçng nh·ªØng g√¨ b·∫°n ƒëang c√≥.", a: "Khuy·∫øt danh"},
            {t: "ƒê·ª´ng ch·ªù ƒë·ª£i. Th·ªùi gian s·∫Ω kh√¥ng bao gi·ªù l√† 'v·ª´a ƒë√∫ng' ƒë√¢u.", a: "Napoleon Hill"}
        ];

        function initDailyQuote() {
            const today = new Date();
            const start = new Date(today.getFullYear(), 0, 0);
            const diff = today - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            const quote = quotesDB[dayOfYear % quotesDB.length];
            const quoteContainer = document.getElementById('quote-text');
            quoteContainer.innerHTML = `<span style="display:block; font-size:0.9em; margin-bottom:8px; color:var(--pastel-pink); font-family:'Segoe UI', sans-serif;">Anh Meo √†,</span> "${quote.t}"`;
            document.getElementById('quote-author').textContent = `‚Äî ${quote.a}`;
            const imgIndex = (dayOfYear % 10) + 1; 
            const card = document.getElementById('daily-quote-card');
            card.style.backgroundImage = `url('images/${imgIndex}.jpg')`;
        }

        const defaultData = `!!! Lam ƒë√¢y! Cloud Sync ƒë√£ s·∫µn s√†ng. V√†o C·∫¨P NH·∫¨T ƒë·ªÉ th·ª≠ nh√©!
# A. üî• URGENT
- [A-01] Mua b√∫t v·∫Ω | M√†u n∆∞·ªõc Winsor & Newton
- [A-02] Tham kh·∫£o web | https://google.com

# B. üåü CORE
- [B-01] Vi·∫øt content

# C. üß± FOUNDATION
- [C-01] H·ªçc ti·∫øng Anh

# D. üí§ KHO √ù T∆Ø·ªûNG / (L√ÄM KHI R·∫¢NH)
- [D-01] S·∫Øp x·∫øp l·∫°i t·ªß s√°ch
- [D-02] T√¨m hi·ªÉu v·ªÅ Notion API`;

        function renderDashboard(text) {
            const container = document.getElementById('dashboard-container');
            container.innerHTML = '';
            const lamMsgElement = document.getElementById('lam-msg');
            let lamMsgFound = false;
            const lines = text.split('\n');
            let currentBox, currentList;
            let currentTaskItem = null;

            lines.forEach(line => {
                let trimmedLine = line.trim();
                if (!trimmedLine) return;

                if (trimmedLine.startsWith('!!!')) {
                    lamMsgElement.textContent = trimmedLine.replace('!!!', '').trim();
                    lamMsgFound = true;
                    return; 
                }

                if (trimmedLine.startsWith('^')) {
                    if (currentTaskItem) {
                        let extraContent = trimmedLine.substring(1).trim();
                        if (extraContent.match(/https?:\/\//)) {
                            extraContent = extraContent.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
                        }
                        let noteBox = currentTaskItem.querySelector('.task-note-box');
                        let noteBtn = currentTaskItem.querySelector('.btn-note-toggle');
                        if (!noteBox) {
                            const noteId = 'note-' + Math.random().toString(36).substr(2, 9);
                            const noteBoxHTML = `<div id="${noteId}" class="task-note-box"></div>`;
                            currentTaskItem.insertAdjacentHTML('beforeend', noteBoxHTML);
                            noteBox = currentTaskItem.querySelector('.task-note-box');
                            noteBtn.setAttribute('onclick', `toggleNote('${noteId}')`);
                            noteBtn.classList.add('has-content');
                        }
                        noteBox.innerHTML += `<span class="note-line">${extraContent}</span>`;
                        noteBtn.classList.add('has-content');
                    }
                    return;
                }

                if (trimmedLine.startsWith('#')) {
                    currentTaskItem = null;
                    const title = trimmedLine.replace('#', '').trim();
                    const h2 = document.createElement('h2'); h2.textContent = title; container.appendChild(h2);
                    currentBox = document.createElement('div'); currentBox.className = 'box';
                    currentBox.setAttribute('data-type', title.toUpperCase()); container.appendChild(currentBox);
                    currentList = document.createElement('ul'); currentList.className = 'task-list'; currentBox.appendChild(currentList);
                } else if (trimmedLine.startsWith('*')) {
                    if (currentBox) {
                        const note = document.createElement('span'); note.className = 'note';
                        note.textContent = trimmedLine.replace('*', '').trim(); currentBox.insertBefore(note, currentList);
                    }
                } else if (trimmedLine.startsWith('-')) {
                    if (currentList) {
                        let level = 1;
                        if (trimmedLine.startsWith('---')) level = 3; else if (trimmedLine.startsWith('--')) level = 2;
                        
                        let parts = trimmedLine.replace(/^-+/, '').split('|');
                        let rawText = parts[0].trim();
                        let inlineNote = parts.length > 1 ? parts[1].trim() : "";

                        let displayHTML = rawText;
                        const idMatch = rawText.match(/^\[([A-Za-z])-?(\d+)\]/);
                        if (idMatch) {
                            const fullTag = idMatch[0]; const letter = idMatch[1].toUpperCase(); const restOfText = rawText.substring(fullTag.length).trim();
                            let tagClass = 'tag-D';
                            if (letter === 'A') tagClass = 'tag-A'; else if (letter === 'B') tagClass = 'tag-B'; else if (letter === 'C') tagClass = 'tag-C';
                            displayHTML = `<span class="task-id-tag ${tagClass}">${fullTag}</span><span class="main-text">${restOfText}</span>`;
                        } else {
                            displayHTML = `<span class="main-text">${rawText}</span>`;
                        }

                        let noteBoxId = "note-" + stringToHash(rawText);
                        let noteBoxHTML = "";
                        let hasNoteClass = "";
                        
                        if (inlineNote) {
                            hasNoteClass = "has-content";
                            if (inlineNote.match(/^https?:\/\//)) {
                                inlineNote = `<a href="${inlineNote}" target="_blank">üîó Link: ${inlineNote}</a>`;
                            }
                            noteBoxHTML = `<div id="${noteBoxId}" class="task-note-box"><span class="note-line">${inlineNote}</span></div>`;
                        }

                        const taskId = 'task-' + stringToHash(rawText);
                        
                        const totalTime = getTotalTime(taskId);
                        const timeBadge = totalTime > 0 ? `<span class="total-time-badge" id="badge-${taskId}">(${totalTime}')</span>` : `<span class="total-time-badge" id="badge-${taskId}" style="display:none"></span>`;

                        const li = document.createElement('li');
                        li.className = `task-item indent-${level}`;
                        li.setAttribute('data-level', level); li.setAttribute('data-id', taskId);
                        
                        li.innerHTML = `
                            <span class="toggle-placeholder"></span>
                            <input type="checkbox" id="${taskId}" onclick="checkTask(this)">
                            <label for="${taskId}" class="task-label">
                                ${displayHTML} ${timeBadge}
                                <div class="mini-progress-container"><div class="mini-progress-fill"></div></div>
                                <span class="mini-progress-text">0%</span>
                            </label>
                            
                            <div class="task-actions">
                                <button class="btn-note-toggle ${hasNoteClass}" onclick="toggleNote('${inlineNote ? noteBoxId : ''}')" title="Xem ghi ch√∫">üìù</button>
                                
                                <div class="time-tracker-box">
                                    <input type="number" class="time-input" placeholder="m..." onkeydown="if(event.key==='Enter') logTime('${taskId}', this)">
                                </div>

                                <button class="btn-timer btn-1m" onclick="startTimer(this, 1)">üöÄ 1'</button>
                                <button class="btn-timer btn-15m" onclick="startTimer(this, 15)">üçÖ 15'</button>
                            </div>
                            ${noteBoxHTML}
                        `;
                        currentList.appendChild(li);
                        currentTaskItem = li;
                        
                        if(localStorage.getItem(taskId) === "true") li.querySelector('input').checked = true;
                    }
                }
            });

            if (!lamMsgFound) lamMsgElement.textContent = "Ch√†o ng√†y m·ªõi! H√£y ch·ªçn vi·ªác quan tr·ªçng nh·∫•t ƒë·ªÉ l√†m tr∆∞·ªõc nh√©.";
            initFolding(container); calculateStats(); 
        }

        function toggleNote(noteId) {
            if (!noteId) return; 
            const noteBox = document.getElementById(noteId);
            if (noteBox) {
                if (noteBox.classList.contains('show')) noteBox.classList.remove('show');
                else noteBox.classList.add('show');
            }
        }

        function toggleTheme() {
            const body = document.body;
            if (body.getAttribute('data-theme') === 'classic') {
                body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'pastel');
            } else {
                body.setAttribute('data-theme', 'classic');
                localStorage.setItem('theme', 'classic');
            }
        }

        // --- BRAIN DUMP LOGIC ---
        function saveBrainDump() {
            const content = document.getElementById('brain-dump-area').value;
            localStorage.setItem('zetmeo_braindump', content);
        }
        function loadBrainDump() {
            const content = localStorage.getItem('zetmeo_braindump') || '';
            document.getElementById('brain-dump-area').value = content;
        }
        function insertBDTemplate() {
            // NEW TEMPLATE FORMAT (V23.1)
            const template = `\n\n--- KHO NH√ÅP C·ª¶A MEO (X·∫£ l√°ng, kh√¥ng c·∫ßn ƒë·∫πp) ---\n\n- [Vi·ªác] \n- [?] `;
            const area = document.getElementById('brain-dump-area');
            area.value += template;
            saveBrainDump();
        }
        function copyBrainDump() {
            const content = document.getElementById('brain-dump-area').value;
            navigator.clipboard.writeText(content).then(() => {
                const t = document.getElementById("toast"); t.innerText = "üìã ƒê√£ copy n·ªôi dung nh√°p!"; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000);
            });
        }
        function clearBrainDump() {
            if(confirm('X√≥a h·∫øt nh√°p nha anh?')) {
                document.getElementById('brain-dump-area').value = "";
                saveBrainDump();
            }
        }

        // --- BOOK IDEAS ARCHIVE SYSTEM ---
        function saveBookIdeas() {
            const content = document.getElementById('book-ideas-area').value;
            localStorage.setItem('zetmeo_book_draft_current', content);
        }
        function loadBookIdeas() {
            document.getElementById('book-ideas-area').value = localStorage.getItem('zetmeo_book_draft_current') || '';
        }
        function insertBookTemplate(type) {
            let template = "";
            if (type === 'char') template = `\n\nüë§ [H·ªí S∆† NH√ÇN V·∫¨T]\n- T√™n:\n- Vai tr√≤:\n- Khao kh√°t l·ªõn nh·∫•t:\n- N·ªói s·ª£ l·ªõn nh·∫•t:\n- Th√≥i quen x·∫•u:`;
            else if (type === 'chapter') template = `\n\nüé¨ [C·∫§U TR√öC CH∆Ø∆†NG]\n1. M·ªü ƒë·∫ßu (Hook):\n2. Xung ƒë·ªôt (Conflict):\n3. Cao tr√†o (Climax):\n4. K·∫øt th√∫c (Cliffhanger):`;
            else template = `\n\nüíé [√ù T∆Ø·ªûNG TH√î]\n- `;
            const area = document.getElementById('book-ideas-area');
            area.value += template;
            saveBookIdeas();
        }
        function mergeToMasterDraft() {
            const currentDraft = document.getElementById('book-ideas-area').value.trim();
            if (!currentDraft) { alert("Ch∆∞a c√≥ g√¨ ƒë·ªÉ g·ªôp h·∫øt anh ∆°i!"); return; }
            if(confirm("G·ªôp n·ªôi dung n√†y v√†o B·∫£n Th·∫£o Chung v√† x√≥a √¥ nh·∫≠p li·ªáu?")) {
                let masterDraft = localStorage.getItem('zetmeo_book_master') || "";
                const now = new Date().toLocaleString();
                const separator = `\n\n========================================\nüìÖ NG√ÄY GHI: ${now}\n========================================\n`;
                masterDraft += separator + currentDraft;
                localStorage.setItem('zetmeo_book_master', masterDraft);
                document.getElementById('book-ideas-area').value = "";
                saveBookIdeas();
                const t = document.getElementById("toast"); t.innerText = "üìö ƒê√£ g·ªôp v√†o B·∫£n Th·∫£o Chung!"; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000);
            }
        }
        function openArchiveModal() {
            const masterDraft = localStorage.getItem('zetmeo_book_master') || "Ch∆∞a c√≥ n·ªôi dung n√†o ƒë∆∞·ª£c g·ªôp.";
            document.getElementById('archive-textarea').value = masterDraft;
            document.getElementById('archive-modal').style.display = 'flex';
        }
        function saveArchive() {
            const newContent = document.getElementById('archive-textarea').value;
            localStorage.setItem('zetmeo_book_master', newContent);
            alert("‚úÖ ƒê√£ l∆∞u thay ƒë·ªïi v√†o B·∫£n Th·∫£o Chung!");
            document.getElementById('archive-modal').style.display = 'none';
        }
        function exportMasterDraft() {
            const content = document.getElementById('archive-textarea').value;
            const blob = new Blob(["\uFEFF" + content], { type: "text/plain;charset=utf-8" });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            const date = new Date().toISOString().slice(0,10);
            link.setAttribute("href", url);
            link.setAttribute("download", `Zetmeo_MASTER_DRAFT_${date}.txt`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- BACKUP & RESTORE & SCHEDULER ---
        function backupFull(isManual = false) {
            const backup = JSON.stringify(localStorage);
            const blob = new Blob([backup], { type: 'application/json' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}_${String(now.getHours()).padStart(2,'0')}-${String(now.getMinutes()).padStart(2,'0')}`;
            link.setAttribute("href", url);
            link.setAttribute("download", `ZetmeoOS_Backup_${dateStr}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            if (isManual) alert("‚úÖ ƒê√£ sao l∆∞u d·ªØ li·ªáu th√†nh c√¥ng!");
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            if(!confirm("‚ö†Ô∏è C·∫¢NH B√ÅO: Vi·ªác n√†y s·∫Ω GHI ƒê√à to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i. B·∫°n c√≥ ch·∫Øc ch·∫Øn kh√¥ng?")) { input.value = ''; return; }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.clear();
                    Object.keys(data).forEach(key => { localStorage.setItem(key, data[key]); });
                    alert("‚úÖ Kh√¥i ph·ª•c th√†nh c√¥ng!"); location.reload();
                } catch (error) { alert("‚ùå L·ªói file backup!"); }
            };
            reader.readAsText(file);
        }

        function initAutoBackupScheduler() {
            setInterval(() => {
                const now = new Date();
                if (now.getHours() === 0 && now.getMinutes() === 0 && now.getSeconds() < 2) backupFull(false);
            }, 1000);
        }

        // --- AIRTABLE CLOUD SYNC (NEW) ---
        async function getRecordID() {
            // Th·ª≠ l·∫•y ID ƒë√£ l∆∞u
            let recordId = localStorage.getItem('zetmeo_cloud_record_id');
            if (recordId) return recordId;

            // N·∫øu ch∆∞a c√≥, h·ªèi Airtable
            try {
                const response = await fetch(AIRTABLE.API_URL, {
                    headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}` }
                });
                const data = await response.json();
                
                if (data.records && data.records.length > 0) {
                    // L·∫•y d√≤ng ƒë·∫ßu ti√™n t√¨m th·∫•y
                    recordId = data.records[0].id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                } else {
                    // N·∫øu ch∆∞a c√≥ d√≤ng n√†o, t·∫°o m·ªõi
                    const createResponse = await fetch(AIRTABLE.API_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE.PAT}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ fields: { "Data": "{}" } }) // T·∫°o d√≤ng r·ªóng tr∆∞·ªõc
                    });
                    const createData = await createResponse.json();
                    recordId = createData.id;
                    localStorage.setItem('zetmeo_cloud_record_id', recordId);
                    return recordId;
                }
            } catch (error) {
                console.error("L·ªói k·∫øt n·ªëi Airtable:", error);
                alert("‚ùå L·ªói k·∫øt n·ªëi Cloud! Ki·ªÉm tra m·∫°ng ho·∫∑c API Key.");
                return null;
            }
        }

        async function syncUp() {
            if (!confirm("‚ö†Ô∏è Upload s·∫Ω GHI ƒê√à d·ªØ li·ªáu tr√™n Cloud b·∫±ng d·ªØ li·ªáu hi·ªán t·∫°i. Ti·∫øp t·ª•c?")) return;
            
            const btn = document.querySelector('.btn-sync'); // Visual feedback
            const originalText = btn.innerText;
            btn.innerText = "‚è≥ ƒêang ƒë·∫©y l√™n...";

            const recordId = await getRecordID();
            if (!recordId) return;

            const payload = JSON.stringify(localStorage);
            
            try {
                const response = await fetch(`${AIRTABLE.API_URL}/${recordId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE.PAT}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fields: {
                            "Data": payload
                        }
                    })
                });

                if (response.ok) {
                    alert("‚úÖ ƒê√£ l∆∞u l√™n M√¢y th√†nh c√¥ng!");
                } else {
                    alert("‚ùå L·ªói khi l∆∞u! C√≥ th·ªÉ do d·ªØ li·ªáu qu√° l·ªõn ho·∫∑c sai c·∫•u tr√∫c.");
                }
            } catch (error) {
                alert("‚ùå L·ªói m·∫°ng: " + error.message);
            } finally {
                btn.innerText = originalText;
            }
        }

        async function syncDown() {
            if (!confirm("‚ö†Ô∏è Download s·∫Ω GHI ƒê√à d·ªØ li·ªáu m√°y n√†y b·∫±ng d·ªØ li·ªáu tr√™n Cloud. Ti·∫øp t·ª•c?")) return;

            const btn = document.querySelectorAll('.btn-sync')[1];
            const originalText = btn.innerText;
            btn.innerText = "‚è≥ ƒêang t·∫£i v·ªÅ...";

            const recordId = await getRecordID();
            if (!recordId) return;

            try {
                const response = await fetch(`${AIRTABLE.API_URL}/${recordId}`, {
                    headers: { 'Authorization': `Bearer ${AIRTABLE.PAT}` }
                });
                const data = await response.json();
                
                if (data.fields && data.fields.Data) {
                    const cloudData = JSON.parse(data.fields.Data);
                    localStorage.clear();
                    Object.keys(cloudData).forEach(key => {
                        localStorage.setItem(key, cloudData[key]);
                    });
                    alert("‚úÖ ƒê·ªìng b·ªô th√†nh c√¥ng! Trang s·∫Ω t·∫£i l·∫°i.");
                    location.reload();
                } else {
                    alert("‚ö†Ô∏è Tr√™n Cloud ch∆∞a c√≥ d·ªØ li·ªáu g√¨ c·∫£!");
                }
            } catch (error) {
                alert("‚ùå L·ªói khi t·∫£i: " + error.message);
            } finally {
                btn.innerText = originalText;
            }
        }

        // --- TIME TRACKER LOGIC ---
        function getLogs() { return JSON.parse(localStorage.getItem('zetmeo_time_logs') || '{}'); }
        function logTime(taskId, input) {
            const minutes = parseInt(input.value);
            if (isNaN(minutes) || minutes <= 0) return;
            let logs = getLogs();
            if (!logs[taskId]) logs[taskId] = [];
            logs[taskId].push({ date: new Date().toISOString(), min: minutes });
            localStorage.setItem('zetmeo_time_logs', JSON.stringify(logs));
            input.value = ''; updateTimeBadge(taskId);
            const t = document.getElementById("toast"); t.innerText = `‚è±Ô∏è ƒê√£ ghi nh·∫≠n ${minutes} ph√∫t!`; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000);
        }
        function getTotalTime(taskId) {
            let logs = getLogs(); if (!logs[taskId]) return 0;
            return logs[taskId].reduce((total, log) => total + log.min, 0);
        }
        function updateTimeBadge(taskId) {
            const total = getTotalTime(taskId);
            const badge = document.getElementById(`badge-${taskId}`);
            if (badge) { badge.textContent = `(${total}')`; badge.style.display = total > 0 ? 'inline-block' : 'none'; }
        }

        function exportCSV() {
            let logs = getLogs();
            let csvContent = "Category,Task ID,Task Name,Date,Time (Minutes)\n";
            const taskMap = {}; 
            const boxes = document.querySelectorAll('.box');
            boxes.forEach(box => {
                const category = box.getAttribute('data-type');
                const taskItems = box.querySelectorAll('.task-item');
                taskItems.forEach(item => {
                    const id = item.getAttribute('data-id');
                    const label = item.querySelector('.task-label').cloneNode(true);
                    const badges = label.querySelectorAll('.total-time-badge, .mini-progress-container, .mini-progress-text');
                    badges.forEach(b => b.remove());
                    taskMap[id] = { name: label.innerText.trim(), category: category };
                });
            });
            for (const [taskId, logArray] of Object.entries(logs)) {
                const taskData = taskMap[taskId] || { name: "Deleted Task", category: "UNKNOWN" };
                logArray.forEach(log => {
                    const dateStr = new Date(log.date).toLocaleString();
                    const safeName = `"${taskData.name.replace(/"/g, '""')}"`;
                    const safeCat = `"${taskData.category}"`;
                    csvContent += `${safeCat},${taskId},${safeName},${dateStr},${log.min}\n`;
                });
            }
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", `Zetmeo_TimeLog_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // --- CORE UTILS ---
        function calculateStats() {
            const statsContainer = document.getElementById('stats-content'); statsContainer.innerHTML = ''; 
            const boxes = document.querySelectorAll('.box'); updateMiniProgressBars();
            const totalBoxes = boxes.length; if (totalBoxes === 0) return;
            const weightPerBox = 100 / totalBoxes; let totalGlobalProgress = 0;
            boxes.forEach(box => {
                const title = box.getAttribute('data-type'); const checkboxes = box.querySelectorAll('input[type="checkbox"]');
                const totalTasks = checkboxes.length; const checkedTasks = box.querySelectorAll('input[type="checkbox"]:checked').length;
                let localPercent = totalTasks > 0 ? (checkedTasks / totalTasks) * 100 : 0;
                const globalContribution = (localPercent / 100) * weightPerBox; totalGlobalProgress += globalContribution;
                let barColorClass = 'bar-core'; if (title.includes('URGENT')) barColorClass = 'bar-urgent'; else if (title.includes('FOUNDATION')) barColorClass = 'bar-foundation';
                const row = document.createElement('div'); row.className = 'stat-row';
                row.innerHTML = `<div class="stat-label"><span>${title} <span style="color:#777; font-size:0.85em">(${weightPerBox.toFixed(0)}%)</span></span><span>${Math.round(localPercent)}%</span></div><div class="stat-bar-bg"><div class="stat-bar-fill ${barColorClass}" style="width: ${localPercent}%"></div></div>`;
                statsContainer.appendChild(row);
            });
            const globalRow = document.createElement('div'); globalRow.className = 'stat-row'; globalRow.style.marginTop = "15px"; globalRow.style.paddingTop = "15px"; globalRow.style.borderTop = "1px solid #333";
            globalRow.innerHTML = `<div class="stat-label"><span style="color: var(--pastel-blue); font-weight:bold">üöÄ TI·∫æN ƒê·ªò NƒÇM 2026</span><span style="color: var(--pastel-blue); font-weight:bold">${totalGlobalProgress.toFixed(1)}%</span></div><div class="stat-bar-bg" style="height:12px; border: 1px solid #555"><div class="stat-bar-fill bar-total" style="width: ${totalGlobalProgress}%"></div></div>`;
            statsContainer.insertBefore(globalRow, statsContainer.firstChild);
        }

        function updateMiniProgressBars() {
            const taskLists = document.querySelectorAll('.task-list');
            taskLists.forEach(list => {
                const items = Array.from(list.children);
                items.forEach((item, index) => {
                    const currentLevel = parseInt(item.getAttribute('data-level'));
                    let childCount = 0; let childChecked = 0; let hasChildren = false;
                    for (let i = index + 1; i < items.length; i++) {
                        const child = items[i]; const childLevel = parseInt(child.getAttribute('data-level'));
                        if (childLevel <= currentLevel) break;
                        hasChildren = true; childCount++;
                        if (child.querySelector('input').checked) childChecked++;
                    }
                    if (hasChildren) {
                        item.classList.add('has-children');
                        const percent = Math.round((childChecked / childCount) * 100);
                        const fill = item.querySelector('.mini-progress-fill');
                        const text = item.querySelector('.mini-progress-text');
                        if (fill) fill.style.width = percent + '%';
                        if (text) text.textContent = percent + '%';
                    } else { item.classList.remove('has-children'); }
                });
            });
        }

        function checkTask(checkbox) { localStorage.setItem(checkbox.id, checkbox.checked); calculateStats(); if (checkbox.checked) { const t = document.getElementById("toast"); t.innerText = "üéâ Xong th√™m 1 vi·ªác!"; t.className = "show"; setTimeout(() => t.className = t.className.replace("show", ""), 3000); } }
        function initFolding(container) {
            const lists = container.querySelectorAll('.task-list');
            lists.forEach(list => {
                const items = Array.from(list.children);
                items.forEach((item, index) => {
                    const currentLevel = parseInt(item.getAttribute('data-level'));
                    const nextItem = items[index + 1]; const nextLevel = nextItem ? parseInt(nextItem.getAttribute('data-level')) : 0;
                    const placeholder = item.querySelector('.toggle-placeholder');
                    if (nextItem && nextLevel > currentLevel) {
                        placeholder.innerHTML = '‚ñ∂'; placeholder.className = 'toggle-btn';
                        const isExpanded = localStorage.getItem('fold-' + item.getAttribute('data-id')) === 'true';
                        if (isExpanded) { placeholder.classList.add('rotated'); placeholder.innerHTML = '‚ñº'; }
                        placeholder.onclick = function() { toggleChildren(items, index, currentLevel, this, item.getAttribute('data-id')); };
                        if (!isExpanded) hideChildren(items, index, currentLevel);
                    } else { placeholder.className = 'spacer'; }
                });
            });
        }
        function toggleChildren(allItems, parentIndex, parentLevel, btn, parentId) {
            const isCollapsing = btn.classList.contains('rotated');
            if (isCollapsing) { btn.classList.remove('rotated'); btn.innerHTML = '‚ñ∂'; localStorage.setItem('fold-' + parentId, 'false'); hideChildren(allItems, parentIndex, parentLevel); } 
            else { btn.classList.add('rotated'); btn.innerHTML = '‚ñº'; localStorage.setItem('fold-' + parentId, 'true'); showChildren(allItems, parentIndex, parentLevel); }
        }
        function hideChildren(allItems, parentIndex, parentLevel) { for (let i = parentIndex + 1; i < allItems.length; i++) { const item = allItems[i]; if (parseInt(item.getAttribute('data-level')) <= parentLevel) break; item.classList.add('hidden-task'); } }
        function showChildren(allItems, parentIndex, parentLevel) {
            for (let i = parentIndex + 1; i < allItems.length; i++) {
                const item = allItems[i]; const level = parseInt(item.getAttribute('data-level')); if (level <= parentLevel) break; item.classList.remove('hidden-task');
                const toggleBtn = item.querySelector('.toggle-btn');
                if (toggleBtn && !toggleBtn.classList.contains('rotated')) { let subParentLevel = level; let j = i + 1; while(j < allItems.length) { if(parseInt(allItems[j].getAttribute('data-level')) <= subParentLevel) break; j++; } i = j - 1; }
            }
        }
        function stringToHash(string) { let hash = 0; if (string.length == 0) return hash; for (let i = 0; i < string.length; i++) { hash = ((hash << 5) - hash) + string.charCodeAt(i); hash = hash & hash; } return Math.abs(hash); }
        function getHistory() { return JSON.parse(localStorage.getItem('dashboardHistory') || '[]'); }
        function saveHistory(content) { let history = getHistory(); history.unshift({ time: new Date().toLocaleString(), content: content }); if (history.length > 5) history.pop(); localStorage.setItem('dashboardHistory', JSON.stringify(history)); }
        function renderHistoryList() { const list = document.getElementById('history-list'); list.innerHTML = ''; const history = getHistory(); if (history.length === 0) { list.innerHTML = '<span style="font-size:0.8em; color:#666">Ch∆∞a c√≥ l·ªãch s·ª≠.</span>'; return; } history.forEach((item) => { const div = document.createElement('div'); div.className = 'history-item'; div.onclick = () => { if(confirm('Kh√¥i ph·ª•c phi√™n b·∫£n n√†y?')) document.getElementById('input-data').value = item.content; }; div.innerHTML = `<span class="history-time">${item.time}</span><span class="history-preview">${item.content.substring(0, 30)}...</span>`; list.appendChild(div); }); }
        function openModal() { 
            const currentData = localStorage.getItem('dashboardData') || defaultData;
            document.getElementById('input-data').value = currentData;
            document.getElementById('old-data').value = currentData; 
            renderHistoryList(); 
            isCompareMode = false;
            document.getElementById('btn-compare').textContent = "üîç SO S√ÅNH (B·∫¨T)";
            document.getElementById('col-old').style.display = 'none';
            document.getElementById('input-data').style.display = 'block';
            document.getElementById('diff-view').style.display = 'none';
            document.getElementById('history-panel').style.display = 'flex'; 
            document.getElementById('edit-modal').style.display = 'flex'; 
        }
        function closeModal() { document.getElementById('edit-modal').style.display = 'none'; }
        function saveData() { const newData = document.getElementById('input-data').value; saveHistory(newData); localStorage.setItem('dashboardData', newData); renderDashboard(newData); closeModal(); }
        let activeInterval, audioCtx;
        function playBeep() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.connect(g); g.connect(audioCtx.destination); o.type = 'sine'; o.frequency.setValueAtTime(800, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(400, audioCtx.currentTime + 0.5); g.gain.setValueAtTime(0.5, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5); o.start(); o.stop(audioCtx.currentTime + 0.5); }
        function startTimer(btn, minutes) { if (activeInterval) clearInterval(activeInterval); document.querySelectorAll('.btn-timer').forEach(b => { b.classList.remove('timer-running'); if(b.dataset.orgText) b.innerText = b.dataset.orgText; b.disabled = false; }); if(!btn.dataset.orgText) btn.dataset.orgText = btn.innerText; let seconds = minutes * 60; btn.classList.add('timer-running'); btn.disabled = true; function update() { let m = Math.floor(seconds / 60); let s = seconds % 60; btn.innerText = `${m}:${s < 10 ? '0' : ''}${s}`; if (seconds < 0) { clearInterval(activeInterval); btn.innerText = "DONE!"; playBeep(); setTimeout(playBeep, 600); setTimeout(playBeep, 1200); setTimeout(() => { btn.classList.remove('timer-running'); btn.innerText = btn.dataset.orgText; btn.disabled = false; }, 3000); } seconds--; } update(); activeInterval = setInterval(update, 1000); }
        function toggleCompare() { isCompareMode = !isCompareMode; const btn = document.getElementById('btn-compare'); const colOld = document.getElementById('col-old'); const inputArea = document.getElementById('input-data'); const diffView = document.getElementById('diff-view'); const historyPanel = document.getElementById('history-panel'); if (isCompareMode) { btn.textContent = "üëÅÔ∏è XEM CODE (EDITOR)"; btn.style.backgroundColor = "#fff"; historyPanel.style.display = 'none'; colOld.style.display = 'flex'; inputArea.style.display = 'none'; diffView.style.display = 'block'; const oldText = document.getElementById('old-data').value; const newText = inputArea.value; diffView.innerHTML = generateDiffHtml(oldText, newText); } else { btn.textContent = "üîç SO S√ÅNH (B·∫¨T)"; btn.style.backgroundColor = "var(--pastel-blue)"; historyPanel.style.display = 'flex'; colOld.style.display = 'none'; inputArea.style.display = 'block'; diffView.style.display = 'none'; } }
        function generateDiffHtml(oldText, newText) { const oldLines = oldText.split('\n').map(l => l.trim()).filter(l => l); const newLines = newText.split('\n').map(l => l.trim()).filter(l => l); let html = ''; newLines.forEach(line => { if (oldLines.includes(line)) { html += `<div class="diff-line diff-same">${line}</div>`; } else { html += `<div class="diff-line diff-added">+ ${line}</div>`; } }); let removedHtml = ''; oldLines.forEach(line => { if (!newLines.includes(line)) { removedHtml += `<div class="diff-line diff-removed">- ${line}</div>`; } }); if (removedHtml) { html += `<div style="margin-top:20px; border-top:1px dashed #555; padding-top:10px; color:#888; font-size:0.8em">C√ÅC M·ª§C ƒê√É B·ªä X√ìA / THAY ƒê·ªîI:</div>` + removedHtml; } return html; }

        window.onload = function() { 
            const data = localStorage.getItem('dashboardData') || defaultData; 
            renderDashboard(data);
            initDailyQuote(); 
            if (localStorage.getItem('theme') === 'classic') {
                document.body.setAttribute('data-theme', 'classic');
            }
            initAutoBackupScheduler();
            loadBrainDump(); 
            loadBookIdeas(); 
            document.getElementById('brain-dump-area').addEventListener('input', saveBrainDump);
            document.getElementById('book-ideas-area').addEventListener('input', saveBookIdeas); 
        }
    </script>
</body>
</html>
